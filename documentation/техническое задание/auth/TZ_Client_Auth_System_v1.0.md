# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ: –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞ Aurora Admin

**–í–µ—Ä—Å–∏—è:** 1.0
**–î–∞—Ç–∞:** 27.12.2024
**–°—Ç–∞—Ç—É—Å:** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

> **‚ö†Ô∏è –í–ê–ñ–ù–û:** –î–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –±–∞–∑–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.
> –î–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ **Auth Control Panel** (–ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
> —Å–º. [TZ_Client_Auth_System_v2.0.md](./TZ_Client_Auth_System_v2.0.md)

---

## Changelog v1.0 ‚Üí v2.0

**–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –≤–µ—Ä—Å–∏–∏ 2.0:**

- üÜï Auth Control Panel - –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
- üÜï Simulator Tab - —Å–∏–º—É–ª—è—Ü–∏—è –æ—à–∏–±–æ–∫ –∏ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- üÜï Playground Tab - —Ä—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API
- üÜï –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö
- üÜï –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ JSON
- üÜï –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Logger Console

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

- –†–∞—Å—à–∏—Ä–µ–Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è auth
- –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –û–±–Ω–æ–≤–ª–µ–Ω—ã —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

---

## 1. –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ Aurora Admin –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –±–∞–∑–µ Angular 18+ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–æ–≤ (Signals, Standalone Components, Functional Guards).

### 1.1 –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- **Cookie-based –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** —Å HttpOnly cookies
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤** (Refresh Token –º–µ—Ö–∞–Ω–∏–∑–º)
- **–†–æ–ª–µ–≤–∞—è –º–æ–¥–µ–ª—å –¥–æ—Å—Ç—É–ø–∞** (RBAC - Role-Based Access Control)
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤** –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- **–ü–µ—Ä–µ—Ö–≤–∞—Ç HTTP –∑–∞–ø—Ä–æ—Å–æ–≤** —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
- **–ó–∞—â–∏—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤** —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ guards
- **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–µ–π**

---

## 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### 2.1 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

```
src/app/auth/
‚îú‚îÄ‚îÄ components/          # UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ login/          # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ register/       # –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ forgot-password/
‚îÇ   ‚îú‚îÄ‚îÄ reset-password/
‚îÇ   ‚îú‚îÄ‚îÄ admin-dashboard/
‚îÇ   ‚îú‚îÄ‚îÄ user-dashboard/
‚îÇ   ‚îî‚îÄ‚îÄ admin-entrance-dashboard/
‚îú‚îÄ‚îÄ services/           # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ auth.service.ts           # –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ token.service.ts          # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ auth.interceptor.ts       # HTTP –∏–Ω—Ç–µ—Ä—Ü–µ–ø—Ç–æ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ role.service.ts           # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ password.service.ts       # –†–∞–±–æ—Ç–∞ —Å –ø–∞—Ä–æ–ª—è–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ user-profile.service.ts   # –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ   ‚îú‚îÄ‚îÄ activity-logs.service.ts  # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
‚îÇ   ‚îî‚îÄ‚îÄ error-handler.service.ts  # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
‚îú‚îÄ‚îÄ guards/             # –ó–∞—â–∏—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ guards.ts       # –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ guards
‚îú‚îÄ‚îÄ models/             # –¢–∏–ø—ã –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
‚îÇ   ‚îú‚îÄ‚îÄ auth.models.ts
‚îÇ   ‚îú‚îÄ‚îÄ user.models.ts
‚îÇ   ‚îú‚îÄ‚îÄ role.models.ts
‚îÇ   ‚îú‚îÄ‚îÄ session.models.ts
‚îÇ   ‚îú‚îÄ‚îÄ activity.models.ts
‚îÇ   ‚îî‚îÄ‚îÄ common.models.ts
‚îú‚îÄ‚îÄ constants/          # –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
‚îú‚îÄ‚îÄ validators/         # –í–∞–ª–∏–¥–∞—Ç–æ—Ä—ã —Ñ–æ—Ä–º
‚îú‚îÄ‚îÄ directives/         # –î–∏—Ä–µ–∫—Ç–∏–≤—ã
‚îú‚îÄ‚îÄ pipes/              # –ü–∞–π–ø—ã
‚îú‚îÄ‚îÄ utils/              # –£—Ç–∏–ª–∏—Ç—ã
‚îî‚îÄ‚îÄ auth.routes.ts      # –ú–∞—Ä—à—Ä—É—Ç—ã –º–æ–¥—É–ª—è
```

---

## 3. –û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

### 3.1 AuthService

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

#### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:

1. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–µ–π:**

   - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
   - –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
   - –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è

2. **–°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (Signals):**

   ```typescript
   private currentUser = signal<UserProfileDto | null>(null);
   private userRoles = signal<string[]>([]);

   public isAuthenticated = computed(() => this.currentUser() !== null);
   public isAdmin = computed(() => this.userRoles().includes('Admin'));
   public isModerator = computed(() => this.userRoles().includes('Moderator'));
   ```

3. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π —Å–µ—Å—Å–∏–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
   - –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞ —á–µ—Ä–µ–∑ API
   - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ localStorage

#### API –º–µ—Ç–æ–¥—ã:

```typescript
// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
register(data: RegisterDto): Observable<ApiResponse<{ user: UserProfileDto }>>

// –í—Ö–æ–¥
login(data: LoginDto): Observable<ApiResponse<{ user: UserProfileDto }>>

// –í—ã—Ö–æ–¥
logout(): Observable<ApiResponse<void>>

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
refreshToken(): Observable<ApiResponse<{ user: UserProfileDto }>>

// –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
getProfile(): Observable<ApiResponse<UserProfileDto>>

// –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è
changePassword(data: ChangePasswordDto): Observable<ApiResponse<void>>

// –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–æ–ª–µ–π
loadUserRoles(): Observable<string[]>
```

#### –ü—É–±–ª–∏—á–Ω—ã–µ –≥–µ—Ç—Ç–µ—Ä—ã:

```typescript
getCurrentUser(): UserProfileDto | null
getUserRoles(): string[]
isLoggedIn(): boolean
isAdminUser(): boolean
isModeratorUser(): boolean
hasRole(role: string): boolean
```

#### –£—Ç–∏–ª–∏—Ç—ã:

```typescript
// –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞ –ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
getRedirectRoute(returnUrl?: string): string

// –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞
redirectAfterLogin(returnUrl?: string): void

// –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
forceTokenRefresh(): Observable<ApiResponse<{ user: UserProfileDto }>>

// –û—á–∏—Å—Ç–∫–∞ —Å–µ—Å—Å–∏–∏
clearSession(): void
```

---

### 3.2 TokenService

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ JWT —Ç–æ–∫–µ–Ω–æ–≤.

#### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:

1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç–æ–∫–µ–Ω–æ–≤:**

   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Å—Ç–∞—Ç—É—Å–µ —Ç–æ–∫–µ–Ω–∞

2. **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å TokenStatus:**

   ```typescript
   interface TokenStatus {
     exists: boolean; // –¢–æ–∫–µ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
     valid: boolean; // –¢–æ–∫–µ–Ω –≤–∞–ª–∏–¥–µ–Ω
     expired: boolean; // –¢–æ–∫–µ–Ω –∏—Å—Ç–µ–∫
     isValid: boolean; // –ê–ª–∏–∞—Å –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
     userEmail: string | null; // Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
     userId: string | null; // ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
     userRoles: string[]; // –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
     expiresAt: Date | null; // –î–∞—Ç–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è
     timeUntilExpiry: number; // –í—Ä–µ–º—è –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è (–º—Å)
     lastChecked: Date; // –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
     claims?: { email?: string };
   }
   ```

3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º:**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ —á–µ—Ä–µ–∑ `/auth/debug-token`
   - –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ cookies —á–µ—Ä–µ–∑ `/auth/debug-cookies`
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç-—Å–µ—Ä–≤–µ—Ä

#### API –º–µ—Ç–æ–¥—ã:

```typescript
// –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
startMonitoring(): void

// –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
stopMonitoring(): void

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ (Observable)
getTokenStatus(): Observable<TokenStatus>

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)
getCurrentStatus(): TokenStatus

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏
isTokenValid(): boolean

// –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
checkTokenStatus(): Observable<TokenStatus>

// –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Å —Å–µ—Ä–≤–µ—Ä–∞
checkServerToken(): Observable<ServerTokenInfo>

// –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ cookies
getCookieInfo(): Observable<CookieInfo>

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–æ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
getUserRoles(): Observable<string[]>

// –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
validateConsistency(
  clientEmail?: string,
  clientRoles?: string[]
): Observable<{
  isConsistent: boolean;
  differences: string[];
  serverInfo: ServerTokenInfo | null;
  clientInfo: { email?: string; roles?: string[] };
}>

// –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
clearStatus(): void
```

#### –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è UI:

```typescript
// –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
formatTimeUntilExpiry(ms: number): string

// –¶–≤–µ—Ç —Å—Ç–∞—Ç—É—Å–∞
getStatusColor(status?: TokenStatus): string

// –¢–µ–∫—Å—Ç —Å—Ç–∞—Ç—É—Å–∞
getStatusText(status?: TokenStatus): string
```

---

### 3.3 AuthInterceptor

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–µ—Ä–µ—Ö–≤–∞—Ç HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –æ—à–∏–±–æ–∫.

#### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ credentials:**

   ```typescript
   const authReq = req.clone({
     withCredentials: true,
     setHeaders: {
       "Content-Type": req.headers.get("Content-Type") || "application/json",
     },
   });
   ```

2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ 401 –æ—à–∏–±–æ–∫:**

   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–ø—ã—Ç–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
   - –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö refresh –∑–∞–ø—Ä–æ—Å–æ–≤
   - –ü–æ–≤—Ç–æ—Ä –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ refresh
   - –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ login –ø—Ä–∏ –Ω–µ—É–¥–∞—á–µ

3. **–ú–µ—Ö–∞–Ω–∏–∑–º refresh —Ç–æ–∫–µ–Ω–∞:**

   ```typescript
   // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è
   let isRefreshing = false;
   const refreshTokenSubject = new BehaviorSubject<any>(null);

   // –õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
   if (isRefreshing) {
     // –û–∂–∏–¥–∞–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ refresh
     return refreshTokenSubject.pipe(
       filter((result) => result !== null),
       take(1),
       switchMap(() => next(request))
     );
   }

   // –ù–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—ã–π refresh
   isRefreshing = true;
   return authService.refreshToken().pipe(
     switchMap(() => next(request)),
     catchError(() => redirectToLogin())
   );
   ```

4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**

   - 401: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π refresh –∏–ª–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç
   - 403: –í–æ–∑–≤—Ä–∞—Ç –æ—à–∏–±–∫–∏ –±–µ–∑ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞
   - –û—Å—Ç–∞–ª—å–Ω—ã–µ: –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ

5. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (—Ç–æ–ª—å–∫–æ –≤ dev —Ä–µ–∂–∏–º–µ):**
   - –ó–∞–ø—Ä–æ—Å—ã: –º–µ—Ç–æ–¥, URL, –∑–∞–≥–æ–ª–æ–≤–∫–∏
   - –û—Ç–≤–µ—Ç—ã: —Å—Ç–∞—Ç—É—Å, –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
   - –û—à–∏–±–∫–∏: –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

#### –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

```typescript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ auth endpoints
function isAuthEndpoint(url: string): boolean;

// –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ login
function redirectToLogin(router: Router, isDevMode: boolean): void;

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
function handleError(error: HttpErrorResponse): Error;

// –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ
function getErrorMessage(error: any): string;
```

---

## 4. Guards (–ó–∞—â–∏—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤)

–í—Å–µ guards —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∫–∞–∫ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ (CanActivateFn) –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å Angular 18+.

### 4.1 authGuard

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ë–∞–∑–æ–≤–∞—è –∑–∞—â–∏—Ç–∞ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

```typescript
export const authGuard: CanActivateFn = (route, state) => {
  const authService = inject(AuthService);
  const router = inject(Router);

  if (authService.isLoggedIn()) {
    return true;
  }

  return router.createUrlTree(["/auth/login"], {
    queryParams: { returnUrl: state.url },
  });
};
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

```typescript
{
  path: 'dashboard',
  canActivate: [authGuard],
  component: DashboardComponent
}
```

---

### 4.2 guestGuard

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ó–∞—â–∏—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü –¥–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (login, register).

```typescript
export const guestGuard: CanActivateFn = (route, state) => {
  const authService = inject(AuthService);
  const router = inject(Router);

  if (!authService.isLoggedIn()) {
    return true;
  }

  // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  const targetRoute = authService.getRedirectRoute();
  return router.createUrlTree([targetRoute]);
};
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

```typescript
{
  path: 'login',
  canActivate: [guestGuard],
  component: LoginComponent
}
```

---

### 4.3 roleGuard

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–µ–π —Å –≥–∏–±–∫–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π.

```typescript
export const roleGuard: CanActivateFn = (route, state) => {
  const authService = inject(AuthService);
  const router = inject(Router);
  const message = inject(NzMessageService);

  if (!authService.isLoggedIn()) {
    return router.createUrlTree(["/auth/login"], {
      queryParams: { returnUrl: state.url },
    });
  }

  const requiredRoles = (route.data?.["roles"] as string[]) || [];
  const requireAll = (route.data?.["requireAll"] as boolean) || false;

  if (requiredRoles.length === 0) {
    return true;
  }

  const userRoles = authService.getUserRoles();
  const hasAccess = requireAll ? requiredRoles.every((role) => userRoles.includes(role)) : requiredRoles.some((role) => userRoles.includes(role));

  if (hasAccess) {
    return true;
  }

  message.error("Insufficient permissions to access this page");
  const targetRoute = authService.getRedirectRoute();
  return router.createUrlTree([targetRoute]);
};
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

```typescript
// –¢—Ä–µ–±—É–µ—Ç—Å—è —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ –∏–∑ —Ä–æ–ª–µ–π
{
  path: 'admin',
  canActivate: [roleGuard],
  data: { roles: ['Admin', 'Moderator'] },
  component: AdminComponent
}

// –¢—Ä–µ–±—É—é—Ç—Å—è –≤—Å–µ —Ä–æ–ª–∏
{
  path: 'super-admin',
  canActivate: [roleGuard],
  data: { roles: ['Admin', 'SuperUser'], requireAll: true },
  component: SuperAdminComponent
}
```

---

### 4.4 adminGuard

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤.

```typescript
export const adminGuard: CanActivateFn = (route, state) => {
  route.data = { ...route.data, roles: ["Admin"] };
  return roleGuard(route, state);
};
```

---

### 4.5 moderatorGuard

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –î–æ—Å—Ç—É–ø –¥–ª—è –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–≤ –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤.

```typescript
export const moderatorGuard: CanActivateFn = (route, state) => {
  route.data = { ...route.data, roles: ["Admin", "Moderator"] };
  return roleGuard(route, state);
};
```

---

### 4.6 userOnlyGuard

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–∏—Å–∫–ª—é—á–∞–µ—Ç –∞–¥–º–∏–Ω–æ–≤).

```typescript
export const userOnlyGuard: CanActivateFn = (route, state) => {
  const authService = inject(AuthService);
  const router = inject(Router);

  if (!authService.isLoggedIn()) {
    return router.createUrlTree(["/auth/login"], {
      queryParams: { returnUrl: state.url },
    });
  }

  const userRoles = authService.getUserRoles();

  if (userRoles.includes("Admin")) {
    return router.createUrlTree(["/admin-entrance-dashboard"]);
  }

  if (userRoles.includes("Moderator")) {
    return router.createUrlTree(["/moderator/dashboard"]);
  }

  return true;
};
```

---

## 5. –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

### 5.1 –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

```typescript
// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
interface RegisterDto {
  firstName: string;
  lastName: string;
  email: string;
  password: string;
}

// –í—Ö–æ–¥
interface LoginDto {
  email: string;
  password: string;
}

// –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è
interface ChangePasswordDto {
  currentPassword: string;
  newPassword: string;
  confirmPassword: string;
}

// –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è
interface ForgotPasswordDto {
  email: string;
}

interface ResetPasswordDto {
  email: string;
  token: string;
  newPassword: string;
}
```

### 5.2 –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

```typescript
interface UserProfileDto {
  fullName: string;
  email: string;
  department?: string;
  avatar?: string;
  isActive: boolean;
  createdAt: string;
  lastLogin?: string;
}
```

### 5.3 –û—Ç–≤–µ—Ç—ã API

```typescript
interface ApiResponse<T = any> {
  success: boolean;
  message?: string;
  data?: T;
}

interface AuthResponseDto {
  accessToken: string;
  refreshToken: string;
  expiresAt: string;
  user: UserProfileDto;
  requiresTwoFactor: boolean;
}
```

---

## 6. –ü–æ—Ç–æ–∫–∏ —Ä–∞–±–æ—Ç—ã (Flows)

### 6.1 –ü–æ—Ç–æ–∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ—Ä–º—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
2. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –≤—ã–∑—ã–≤–∞–µ—Ç authService.register(data)
3. AuthService –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST /auth/register
4. –ü—Ä–∏ —É—Å–ø–µ—Ö–µ:
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ currentUser signal
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ localStorage
   - –ó–∞–ø—É—Å–∫–∞–µ—Ç tokenService.startMonitoring()
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Ä–æ–ª–∏ —á–µ—Ä–µ–∑ loadUserRoles()
   - –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π dashboard
5. –ü—Ä–∏ –æ—à–∏–±–∫–µ:
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
   - –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
```

### 6.2 –ü–æ—Ç–æ–∫ –≤—Ö–æ–¥–∞

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç email –∏ –ø–∞—Ä–æ–ª—å
2. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –≤—ã–∑—ã–≤–∞–µ—Ç authService.login(data)
3. AuthService –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST /auth/login —Å withCredentials: true
4. –°–µ—Ä–≤–µ—Ä —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç HttpOnly cookies (access_token, refresh_token)
5. –ü—Ä–∏ —É—Å–ø–µ—Ö–µ:
   - –û–±–Ω–æ–≤–ª—è–µ—Ç currentUser signal
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ localStorage
   - –ó–∞–ø—É—Å–∫–∞–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç–æ–∫–µ–Ω–æ–≤
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Ä–æ–ª–∏
   - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ü–µ–ª–µ–≤–æ–π –º–∞—Ä—à—Ä—É—Ç —á–µ—Ä–µ–∑ getRedirectRoute()
   - –í—ã–ø–æ–ª–Ω—è–µ—Ç redirectAfterLogin()
6. –ü—Ä–∏ –æ—à–∏–±–∫–µ:
   - –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
```

### 6.3 –ü–æ—Ç–æ–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ refresh —Ç–æ–∫–µ–Ω–∞

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ –∑–∞—â–∏—â–µ–Ω–Ω–æ–º—É API
2. AuthInterceptor –¥–æ–±–∞–≤–ª—è–µ—Ç withCredentials: true
3. –°–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 401 (—Ç–æ–∫–µ–Ω –∏—Å—Ç–µ–∫)
4. AuthInterceptor –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É:
   a. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–µ –∏–¥–µ—Ç –ª–∏ —É–∂–µ refresh (isRefreshing)
   b. –ï—Å–ª–∏ –¥–∞ - —Å—Ç–∞–≤–∏—Ç –∑–∞–ø—Ä–æ—Å –≤ –æ—á–µ—Ä–µ–¥—å —á–µ—Ä–µ–∑ refreshTokenSubject
   c. –ï—Å–ª–∏ –Ω–µ—Ç:
      - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç isRefreshing = true
      - –í—ã–∑—ã–≤–∞–µ—Ç authService.refreshToken()
      - POST /auth/refresh —Å withCredentials: true
      - –°–µ—Ä–≤–µ—Ä –æ–±–Ω–æ–≤–ª—è–µ—Ç cookies
      - –ü—Ä–∏ —É—Å–ø–µ—Ö–µ:
        * –û–±–Ω–æ–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        * –ü–æ–≤—Ç–æ—Ä—è–µ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å
        * –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç –æ—á–µ—Ä–µ–¥—å (refreshTokenSubject.next(true))
      - –ü—Ä–∏ –Ω–µ—É–¥–∞—á–µ:
        * –û—á–∏—â–∞–µ—Ç —Å–µ—Å—Å–∏—é
        * –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ /auth/login
5. –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å –Ω–æ–≤—ã–º —Ç–æ–∫–µ–Ω–æ–º
```

### 6.4 –ü–æ—Ç–æ–∫ –≤—ã—Ö–æ–¥–∞

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–í—ã—Ö–æ–¥"
2. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –≤—ã–∑—ã–≤–∞–µ—Ç authService.logout()
3. AuthService –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST /auth/logout
4. –°–µ—Ä–≤–µ—Ä —É–¥–∞–ª—è–µ—Ç cookies
5. –ö–ª–∏–µ–Ω—Ç:
   - –û—á–∏—â–∞–µ—Ç currentUser –∏ userRoles signals
   - –£–¥–∞–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage
   - –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç–æ–∫–µ–Ω–æ–≤ (tokenService.clearStatus())
   - –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ /auth/login
```

### 6.5 –ü–æ—Ç–æ–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ç–æ–∫–µ–Ω–æ–≤

```
1. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è tokenService.startMonitoring()
2. –°–µ—Ä–≤–∏—Å –∑–∞–ø—É—Å–∫–∞–µ—Ç timer(30000, 30000) - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
3. –ü—Ä–∏ –∫–∞–∂–¥–æ–π –ø—Ä–æ–≤–µ—Ä–∫–µ:
   - GET /auth/debug-token —Å withCredentials: true
   - –°–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–∫–µ–Ω–µ
   - TokenService –æ–±–Ω–æ–≤–ª—è–µ—Ç tokenStatus$ BehaviorSubject
   - –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ –Ω–∞ getTokenStatus() –ø–æ–ª—É—á–∞—é—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
4. –ü—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–ª–∏ –æ—à–∏–±–∫–µ:
   - stopMonitoring() –æ—Ç–º–µ–Ω—è–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø—É—Å—Ç–æ–π —Å—Ç–∞—Ç—É—Å
```

---

## 7. –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

### 7.1 LocalStorage

```typescript
// –ö–ª—é—á–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è
STORAGE_KEYS = {
  USER_DATA: "user_data",
  AUTH_TOKEN: "auth_token", // –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (—Ç–æ–∫–µ–Ω—ã –≤ cookies)
  REFRESH_TOKEN: "refresh_token", // –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
};

// –°–æ—Ö—Ä–∞–Ω—è–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ
interface StoredUserData {
  fullName: string;
  email: string;
  department?: string;
  avatar?: string;
  isActive: boolean;
  createdAt: string;
  lastLogin?: string;
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –¢–æ–∫–µ–Ω—ã –ù–ï —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ localStorage –ø–æ —Å–æ–æ–±—Ä–∞–∂–µ–Ω–∏—è–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è HttpOnly cookies.

### 7.2 Cookies (—É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Å–µ—Ä–≤–µ—Ä–æ–º)

```
access_token  - HttpOnly, Secure, SameSite=Strict
refresh_token - HttpOnly, Secure, SameSite=Strict
```

---

## 8. API Endpoints

### 8.1 –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

```typescript
POST / api / auth / register;
POST / api / auth / login;
POST / api / auth / logout;
POST / api / auth / refresh;
POST / api / auth / change - password;
POST / api / auth / forgot - password;
POST / api / auth / reset - password;
```

### 8.2 –ü—Ä–æ—Ñ–∏–ª—å

```typescript
GET / api / auth / profile;
PUT / api / auth / profile;
```

### 8.3 –û—Ç–ª–∞–¥–∫–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

```typescript
GET / api / auth / debug - token; // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–∫—É—â–µ–º —Ç–æ–∫–µ–Ω–µ
GET / api / auth / debug - cookies; // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ cookies
```

---

## 9. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### 9.1 –ú–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

1. **HttpOnly Cookies:**

   - –¢–æ–∫–µ–Ω—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è JavaScript
   - –ó–∞—â–∏—Ç–∞ –æ—Ç XSS –∞—Ç–∞–∫

2. **Secure & SameSite:**

   - –ü–µ—Ä–µ–¥–∞—á–∞ —Ç–æ–ª—å–∫–æ –ø–æ HTTPS
   - –ó–∞—â–∏—Ç–∞ –æ—Ç CSRF –∞—Ç–∞–∫

3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π refresh:**

   - –ö–æ—Ä–æ—Ç–∫–∏–π —Å—Ä–æ–∫ –∂–∏–∑–Ω–∏ access —Ç–æ–∫–µ–Ω–∞
   - –î–ª–∏—Ç–µ–ª—å–Ω—ã–π refresh —Ç–æ–∫–µ–Ω

4. **–í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ:**

   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ email
   - –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–∞—Ä–æ–ª—é
   - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è

5. **–ó–∞—â–∏—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤:**

   - Guards –ø—Ä–æ–≤–µ—Ä—è—é—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
   - –†–æ–ª–µ–≤–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ returnUrl –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞

6. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –≤ dev —Ä–µ–∂–∏–º–µ

### 9.2 –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

1. **–°–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏:**

   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry –¥–ª—è 401
   - –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

2. **–í–∞–ª–∏–¥–∞—Ü–∏—è:**

   - –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º
   - –°–µ—Ä–≤–µ—Ä–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

3. **–¢–∞–π–º–∞—É—Ç—ã:**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
   - –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ —Å–∫–æ—Ä–æ–º –∏—Å—Ç–µ—á–µ–Ω–∏–∏
   - Graceful logout –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏

---

## 10. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å UI

### 10.1 –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö

```typescript
@Component({
  selector: "app-dashboard",
  template: `
    @if (authService.isAuthenticated()) {
    <div class="dashboard">
      <h1>Welcome, {{ authService.getCurrentUser()?.fullName }}</h1>

      @if (authService.isAdmin()) {
      <admin-panel />
      } @if (authService.isModerator()) {
      <moderator-panel />
      }
    </div>
    }
  `,
})
export class DashboardComponent {
  authService = inject(AuthService);
}
```

### 10.2 –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç–æ–∫–µ–Ω–æ–≤ –≤ UI

```typescript
@Component({
  selector: "app-token-status",
  template: `
    <div class="token-status" [style.color]="statusColor()">
      <span>{{ statusText() }}</span>
      <span>{{ timeRemaining() }}</span>
    </div>
  `,
})
export class TokenStatusComponent {
  private tokenService = inject(TokenService);

  status = toSignal(this.tokenService.getTokenStatus());

  statusColor = computed(() => this.tokenService.getStatusColor(this.status()));

  statusText = computed(() => this.tokenService.getStatusText(this.status()));

  timeRemaining = computed(() => {
    const s = this.status();
    return s ? this.tokenService.formatTimeUntilExpiry(s.timeUntilExpiry) : "";
  });
}
```

---

## 11. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 11.1 –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```
src/app/auth/components/test/
‚îú‚îÄ‚îÄ test-auth/          # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ test-cors/          # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ CORS
‚îú‚îÄ‚îÄ token-test/         # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
‚îú‚îÄ‚îÄ test-one-user/      # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îî‚îÄ‚îÄ test-two-user/      # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–≤—É—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```

### 11.2 –°—Ü–µ–Ω–∞—Ä–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –≤—Ö–æ–¥:**

   - –£—Å–ø–µ—à–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª–µ–π
   - –î—É–±–ª–∏–∫–∞—Ç email
   - –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥
   - –ù–µ–≤–µ—Ä–Ω—ã–µ credentials

2. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–µ–π:**

   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π refresh
   - –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏
   - –ò—Å—Ç–µ—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
   - –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π logout

3. **–†–æ–ª–∏ –∏ –¥–æ—Å—Ç—É–ø:**

   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–µ–π
   - –î–æ—Å—Ç—É–ø –∫ –∑–∞—â–∏—â–µ–Ω–Ω—ã–º –º–∞—Ä—à—Ä—É—Ç–∞–º
   - –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø—Ä–∞–≤

4. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è:**
   - –ó–∞–ø—Ä–æ—Å —Å–±—Ä–æ—Å–∞
   - –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
   - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è

---

## 12. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### 12.1 Environment

```typescript
// environment.ts
export const environment = {
  production: false,
  api: {
    baseUrl: "https://localhost:7233/api",
  },
};
```

### 12.2 API Endpoints

```typescript
// api-endpoints.ts
export const ApiEndpoints = {
  AUTH: {
    BASE: "/api/auth",
    REGISTER: "/api/auth/register",
    LOGIN: "/api/auth/login",
    LOGOUT: "/api/auth/logout",
    REFRESH: "/api/auth/refresh",
    PROFILE: "/api/auth/profile",
    CHANGE_PASSWORD: "/api/auth/change-password",
    FORGOT_PASSWORD: "/api/auth/forgot-password",
    RESET_PASSWORD: "/api/auth/reset-password",
  },
};

export const STORAGE_KEYS = {
  USER_DATA: "user_data",
  AUTH_TOKEN: "auth_token",
  REFRESH_TOKEN: "refresh_token",
};
```

---

## 13. –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### 13.1 –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

1. **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ guards:**

   ```typescript
   {
     path: 'protected',
     canActivate: [authGuard],
     component: ProtectedComponent
   }
   ```

2. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ä–æ–ª–∏ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö:**

   ```typescript
   @if (authService.hasRole('Admin')) {
     <admin-content />
   }
   ```

3. **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –æ—à–∏–±–∫–∏:**

   ```typescript
   authService.login(data).subscribe({
     next: () => this.router.navigate(["/dashboard"]),
     error: (err) => this.message.error(err.message),
   });
   ```

4. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Signals:**

   ```typescript
   isAuthenticated = authService.isAuthenticated;
   currentUser = authService.getCurrentUser;
   ```

5. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω—ã –≤ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö:**
   ```typescript
   tokenStatus = toSignal(tokenService.getTokenStatus());
   ```

### 13.2 –ß—Ç–æ –ù–ï –¥–µ–ª–∞—Ç—å

1. ‚ùå –ù–µ —Ö—Ä–∞–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω—ã –≤ localStorage
2. ‚ùå –ù–µ –æ—Ç–∫–ª—é—á–∞–π—Ç–µ withCredentials
3. ‚ùå –ù–µ –∏–≥–Ω–æ—Ä–∏—Ä—É–π—Ç–µ –æ—à–∏–±–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
4. ‚ùå –ù–µ –¥—É–±–ª–∏—Ä—É–π—Ç–µ –ª–æ–≥–∏–∫—É guards
5. ‚ùå –ù–µ –∑–∞–±—ã–≤–∞–π—Ç–µ –ø—Ä–æ cleanup –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ

---

## 14. –î–∏–∞–≥—Ä–∞–º–º—ã

### 14.1 –î–∏–∞–≥—Ä–∞–º–º–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Angular Application                  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                ‚îÇ
‚îÇ  ‚îÇ   Guards     ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  AuthService ‚îÇ                ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                ‚îÇ
‚îÇ                               ‚îÇ                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê            ‚îÇ                          ‚îÇ
‚îÇ  ‚îÇ Components   ‚îÇ‚óÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§                          ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò            ‚îÇ                          ‚îÇ
‚îÇ                               ‚îÇ                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                ‚îÇ
‚îÇ  ‚îÇ Interceptor  ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇTokenService  ‚îÇ                ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                ‚îÇ
‚îÇ         ‚îÇ                                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
          ‚îÇ
          ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Backend API                           ‚îÇ
‚îÇ  /auth/login, /auth/refresh, /auth/profile, etc.       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 14.2 –î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö

```
User Action
    ‚îÇ
    ‚ñº
Component
    ‚îÇ
    ‚ñº
AuthService ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ                     ‚îÇ
    ‚ñº                     ‚ñº
HTTP Request         Update Signals
    ‚îÇ                     ‚îÇ
    ‚ñº                     ‚ñº
Interceptor          UI Updates
    ‚îÇ
    ‚ñº
Backend API
    ‚îÇ
    ‚ñº
Response (with cookies)
    ‚îÇ
    ‚ñº
AuthService
    ‚îÇ
    ‚ñº
TokenService.startMonitoring()
```

---

## 15. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ Aurora Admin –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ, –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –≤ Angular –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö.

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** HttpOnly cookies, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π refresh, –∑–∞—â–∏—Ç–∞ –æ—Ç XSS/CSRF
‚úÖ **–£–¥–æ–±—Å—Ç–≤–æ:** Signals –¥–ª—è —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏, —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ guards, –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è
‚úÖ **–ì–∏–±–∫–æ—Å—Ç—å:** –†–æ–ª–µ–≤–∞—è –º–æ–¥–µ–ª—å, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ guards, —Ä–∞—Å—à–∏—Ä—è–µ–º–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:** –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç–æ–∫–µ–Ω–æ–≤, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚úÖ **–°–æ–≤—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å:** Angular 18+, Standalone Components, TypeScript

### –î–∞–ª—å–Ω–µ–π—à–µ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ:

- –î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (2FA)
- OAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã (Google, GitHub)
- –ë–∏–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- Session management (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã–º–∏ —Å–µ—Å—Å–∏—è–º–∏)
- Advanced logging –∏ –∞—É–¥–∏—Ç

---

**–î–æ–∫—É–º–µ–Ω—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω:** 27.12.2024
**–í–µ—Ä—Å–∏—è —Å–∏—Å—Ç–µ–º—ã:** Aurora Admin v1.0
**–°—Ç–∞—Ç—É—Å:** Production Ready
