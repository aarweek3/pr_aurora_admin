# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ: @aurora/i18n - Production-Ready Version

**–í–µ—Ä—Å–∏—è**: 2.2 (–§–∏–Ω–∞–ª—å–Ω–∞—è —Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏)
**–î–∞—Ç–∞**: 28 –¥–µ–∫–∞–±—Ä—è 2025
**–°—Ç–∞—Ç—É—Å**: Ready for Implementation

## 1. Executive Summary

### 1.1 –¶–µ–ª—å

–°–æ–∑–¥–∞—Ç—å production-ready Angular –±–∏–±–ª–∏–æ—Ç–µ–∫—É –¥–ª—è –∏–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ —Å –¥–æ–º–µ–Ω–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏. –†–µ—à–∞–µ—Ç 90% –∑–∞–¥–∞—á –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π –∫–æ–¥–∞, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –¥–æ enterprise –±–µ–∑ breaking changes.

### 1.2 –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

- **Simple by Default, Powerful by Design** - –¥–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ API
- **Domain-First Strategy** - –¥–æ–º–µ–Ω –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —è–∑—ã–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- **Language-Based** - –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —è–∑—ã–∫–∞–º –Ω–∞–¥ –ª–æ–∫–∞–ª—è–º–∏ (en vs en-US/en-GB)
- **Signals-Native** - —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ Angular signals
- **Standalone-Only** - —Ç–æ–ª—å–∫–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π Angular, –Ω–∏–∫–∞–∫–∏—Ö NgModule
- **Zero Configuration** - —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –∫–æ—Ä–æ–±–∫–∏ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏

### 1.3 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

- **APP_INITIALIZER** - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç FOUC (Flash of Untranslated Content)
- **Memory Management** - –∫–µ—à –ø–µ—Ä–µ–≤–æ–¥–æ–≤ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º (5 —è–∑—ã–∫–æ–≤ –º–∞–∫—Å–∏–º—É–º)
- **SSR-Safe** - —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Å–µ—Ä–≤–µ—Ä–Ω—ã–º —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–æ–º
- **Extensible Language Info** - –ø–æ–¥–∫–ª—é—á–∞–µ–º—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã —è–∑—ã–∫–æ–≤–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

## 2. API Architecture

### 2.1 Two-Level API Design

```typescript
// Level 1: Simple API (90% —Å–ª—É—á–∞–µ–≤)
provideAuroraI18n(domainMap, options?)

// Level 2: Advanced API (10% —Å–ª—É—á–∞–µ–≤)
provideAuroraI18nAdvanced(config)
```

### 2.2 Core Interfaces

```typescript
// ============================================================================
// üéØ PUBLIC API INTERFACES
// ============================================================================

/**
 * –ü—Ä–æ—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤
 */
export function provideAuroraI18n(
  domainMap: Record<string, string>,
  options?: {
    /** –ü—É—Ç—å –∫ —Ñ–∞–π–ª–∞–º –ø–µ—Ä–µ–≤–æ–¥–æ–≤ @default '/assets/i18n' */
    translationsPath?: string;

    /** Fallback —è–∑—ã–∫ @default –ø–µ—Ä–≤—ã–π –∏–∑ domainMap */
    fallbackLanguage?: string;

    /** –û–±–Ω–æ–≤–ª—è—Ç—å HTML lang –∏ meta —Ç–µ–≥–∏ @default true */
    enableLanguageMeta?: boolean;
  }
): Provider[];

/**
 * –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è enterprise –ø—Ä–æ–µ–∫—Ç–æ–≤
 */
export function provideAuroraI18nAdvanced(config: {
  /** –ö–∞—Ä—Ç–∞ –¥–æ–º–µ–Ω–æ–≤ –∫ —è–∑—ã–∫–∞–º */
  domainMap: Record<string, string>;

  /** –ö–∞—Å—Ç–æ–º–Ω—ã–π –¥–µ—Ç–µ–∫—Ç–æ—Ä —è–∑—ã–∫–∞ */
  languageResolver?: LanguageResolver;

  /** –ê–¥–∞–ø—Ç–µ—Ä –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è meta-—Ç–µ–≥–∞–º–∏ */
  metaAdapter?: LanguageMetaAdapter;

  /** –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞ */
  storageStrategy?: StorageStrategy;

  /** –ó–∞–≥—Ä—É–∑—á–∏–∫ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ */
  translationLoader?: TranslationLoader;

  /** –ü—Ä–æ–≤–∞–π–¥–µ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —è–∑—ã–∫–∞—Ö */
  languageInfoProvider?: LanguageInfoProvider;

  /** –ö–æ–ª–ª–±—ç–∫ –ø—Ä–∏ —Å–º–µ–Ω–µ —è–∑—ã–∫–∞ */
  onLanguageChange?: (from: string, to: string) => void | Promise<void>;
}): Provider[];

// ============================================================================
// üîß EXTENSIBILITY INTERFACES
// ============================================================================

export interface LanguageResolver {
  detectLanguage(hostname: string, search: string): string | Promise<string>;
  isLanguageSupported(lang: string): boolean;
  isLanguageAllowedForDomain(lang: string, hostname: string): boolean;
}

export interface LanguageMetaAdapter {
  updateHtmlLang(lang: string): void;
  updateMetaTags(lang: string): void;
  generateHreflangLinks(languages: LanguageInfo[]): void;
}

export interface StorageStrategy {
  get(): string | null;
  set(lang: string): void;
  clear(): void;
}

export interface TranslationLoader {
  /**
   * –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥—ã –¥–ª—è —è–∑—ã–∫–∞ (Promise-based API)
   */
  load(lang: string): Promise<Translations>;
}

/**
 * –ü—Ä–æ–≤–∞–π–¥–µ—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —è–∑—ã–∫–∞—Ö (–ù–û–í–´–ô –ò–ù–¢–ï–†–§–ï–ô–°)
 * –ü–æ–∑–≤–æ–ª—è–µ—Ç –∫–∞—Å—Ç–æ–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —è–∑—ã–∫–æ–≤ –±–µ–∑ —Ö–∞—Ä–¥–∫–æ–¥–∞
 */
export interface LanguageInfoProvider {
  /**
   * –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —è–∑—ã–∫–∞—Ö
   * @param languageCodes –ö–æ–¥—ã —è–∑—ã–∫–æ–≤ –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö –Ω—É–∂–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
   * @param domainMap –ö–∞—Ä—Ç–∞ –¥–æ–º–µ–Ω–æ–≤ –∫ —è–∑—ã–∫–∞–º –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–æ–º–µ–Ω–æ–≤
   * @returns –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —è–∑—ã–∫–∞—Ö
   */
  getLanguageInfo(languageCodes: string[], domainMap: Record<string, string>): LanguageInfo[];
}

export type Translations = Record<string, any>;

export interface LanguageInfo {
  /** –ö–æ–¥ —è–∑—ã–∫–∞ (ISO 639-1): 'en', 'de', 'fr' */
  code: string;

  /** –ù–∞–∑–≤–∞–Ω–∏–µ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º: 'German', 'French' */
  name: string;

  /** –ù–∞–∑–≤–∞–Ω–∏–µ –Ω–∞ —Ä–æ–¥–Ω–æ–º —è–∑—ã–∫–µ: 'Deutsch', 'Fran√ßais' */
  nativeName: string;

  /** –§–ª–∞–≥ —ç–º–æ–¥–∑–∏ */
  flag: string;

  /** –°–≤—è–∑–∞–Ω–Ω—ã–π –¥–æ–º–µ–Ω */
  domain: string;

  /** –õ–æ–∫–∞–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è meta —Ç–µ–≥–æ–≤ */
  defaultLocale: string;
}
```

## 3. Core Services Implementation

### 3.1 Translation Service (–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)

```typescript
// ============================================================================
// üì° TRANSLATION SERVICE - –Ø–¥—Ä–æ —Å–∏—Å—Ç–µ–º—ã (—Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏)
// ============================================================================

@Injectable()
export class TranslationService {
  // Memory management
  private readonly MAX_CACHE_LANGS = 5;

  // Private signals –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
  private currentLangSignal = signal<string>("");
  private availableLanguagesSignal = signal<string[]>([]);
  private loadingSignal = signal<boolean>(false);
  private initializedSignal = signal<boolean>(false);
  private translationsSignal = signal<Record<string, Translations>>({});

  // Public readonly signals
  readonly currentLang = this.currentLangSignal.asReadonly();
  readonly availableLanguages = this.availableLanguagesSignal.asReadonly();
  readonly isLoading = this.loadingSignal.asReadonly();
  readonly isInitialized = this.initializedSignal.asReadonly();

  // Computed signals
  readonly currentTranslations = computed(() => {
    const lang = this.currentLang();
    const translations = this.translationsSignal();
    return translations[lang] || {};
  });

  readonly languageInfo = computed(() => {
    const langs = this.availableLanguages();
    // –ò–°–ü–†–ê–í–õ–ï–ù–û: –∏—Å–ø–æ–ª—å–∑—É–µ–º LanguageInfoProvider –≤–º–µ—Å—Ç–æ —Ö–∞—Ä–¥–∫–æ–¥–∞
    return this.languageInfoProvider.getLanguageInfo(langs, this.domainMap);
  });

  constructor(@Inject(I18N_DOMAIN_MAP) private domainMap: Record<string, string>, @Inject(I18N_CONFIG) private config: InternalI18nConfig, private browserService: BrowserService, private metaAdapter: LanguageMetaAdapter, private storageStrategy: StorageStrategy, private translationLoader: TranslationLoader, private languageInfoProvider: LanguageInfoProvider) {}

  /**
   * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ APP_INITIALIZER
   */
  async initialize(): Promise<void> {
    try {
      const availableLanguages = [...new Set(Object.values(this.domainMap))];
      this.availableLanguagesSignal.set(availableLanguages);

      const detectedLang = await this.detectLanguage();
      await this.setLanguage(detectedLang, true);

      this.initializedSignal.set(true);
    } catch (error) {
      console.error("Failed to initialize i18n:", error);
      // –í —Å–ª—É—á–∞–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–∏ –≤—Å—ë —Ä–∞–≤–Ω–æ —Ä–∞–∑—Ä–µ—à–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
      this.currentLangSignal.set(this.config.fallbackLanguage);
      this.initializedSignal.set(true);
    }
  }

  /**
   * –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞ (–ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø —Å LanguageResolver)
   */
  private async detectLanguage(): Promise<string> {
    // 1. Custom Language Resolver (–ò–°–ü–†–ê–í–õ–ï–ù–û: —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è!)
    if (this.config.languageResolver) {
      try {
        const resolved = await this.config.languageResolver.detectLanguage(this.browserService.hostname, this.browserService.search);
        if (this.isLanguageSupported(resolved)) {
          return resolved;
        }
      } catch (error) {
        console.warn("LanguageResolver failed:", error);
      }
    }

    // 2. Query parameter ?lang=
    const urlParams = new URLSearchParams(this.browserService.search);
    const langParam = urlParams.get("lang");
    if (langParam && this.isLanguageSupported(langParam)) {
      return langParam;
    }

    // 3. –°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π –≤ storage (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º —Å –¥–æ–º–µ–Ω–æ–º)
    const savedLang = this.storageStrategy.get();
    if (savedLang && this.isLanguageAllowedForDomain(savedLang)) {
      return savedLang;
    }

    // 4. –Ø–∑—ã–∫ –¥–æ–º–µ–Ω–∞
    const hostname = this.browserService.hostname;
    const domainLang = this.domainMap[hostname];
    if (domainLang) {
      return domainLang;
    }

    // 5. Default fallback
    return this.config.fallbackLanguage;
  }

  /**
   * –ò–°–ü–†–ê–í–õ–ï–ù–û: —É–±—Ä–∞–Ω —Ö–∞—Ä–¥–∫–æ–¥ 'en' + –¥–æ–±–∞–≤–ª–µ–Ω –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ –ª–æ–≥–∏–∫–µ
   */
  private isLanguageAllowedForDomain(lang: string): boolean {
    const hostname = this.browserService.hostname;
    const domainLang = this.domainMap[hostname];

    // INTENTIONAL: restrict languages per domain for SEO consistency
    // This prevents en.example.com from showing Chinese content
    // Only domain language + fallback are allowed to prevent SEO confusion
    return lang === domainLang || lang === this.config.fallbackLanguage;
  }

  /**
   * –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ —Å memory management
   */
  private async ensureTranslationsLoaded(lang: string): Promise<void> {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–µ—à
    if (this.translationsSignal()[lang]) {
      return; // –£–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
    }

    try {
      // –ó–∞–≥—Ä—É–∂–∞–µ–º —á–µ—Ä–µ–∑ loader
      const translations = await this.translationLoader.load(lang);

      // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –û–±–Ω–æ–≤–ª—è–µ–º signal —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –∫–µ—à–∞
      this.translationsSignal.update((current) => {
        const updated = { ...current, [lang]: translations };
        const keys = Object.keys(updated);

        // Memory management: –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —è–∑—ã–∫–æ–≤ –≤ –∫–µ—à–µ
        if (keys.length > this.MAX_CACHE_LANGS) {
          // –£–¥–∞–ª—è–µ–º —Å–∞–º—ã–π —Å—Ç–∞—Ä—ã–π (–ø–µ—Ä–≤—ã–π) —è–∑—ã–∫
          delete updated[keys[0]];
          console.log(`Translation cache limit reached. Removed: ${keys[0]}`);
        }

        return updated;
      });
    } catch (error) {
      console.error(`Failed to load translations for ${lang}:`, error);
      throw error;
    }
  }

  /**
   * –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —è–∑—ã–∫ —Å –∑–∞–≥—Ä—É–∑–∫–æ–π –ø–µ—Ä–µ–≤–æ–¥–æ–≤
   */
  async setLanguage(lang: string, isInitialLoad = false): Promise<void> {
    if (!this.isLanguageSupported(lang)) {
      console.warn(`Unsupported language: ${lang}, falling back to ${this.config.fallbackLanguage}`);
      lang = this.config.fallbackLanguage;
    }

    const previousLang = this.currentLang();

    if (!isInitialLoad) {
      this.loadingSignal.set(true);
    }

    try {
      await this.ensureTranslationsLoaded(lang);

      this.currentLangSignal.set(lang);

      if (this.config.enableLanguageMeta) {
        this.metaAdapter.updateHtmlLang(lang);
        this.metaAdapter.updateMetaTags(lang);
        this.metaAdapter.generateHreflangLinks(this.languageInfo());
      }

      this.storageStrategy.set(lang);

      if (previousLang && previousLang !== lang && this.config.onLanguageChange) {
        await this.config.onLanguageChange(previousLang, lang);
      }
    } catch (error) {
      console.error(`Failed to set language to ${lang}:`, error);

      if (lang !== this.config.fallbackLanguage) {
        try {
          await this.ensureTranslationsLoaded(this.config.fallbackLanguage);
          this.currentLangSignal.set(this.config.fallbackLanguage);
        } catch (fallbackError) {
          console.error("Critical error: fallback language failed to load", fallbackError);
          throw new Error("Failed to load any translations");
        }
      } else {
        throw error;
      }
    } finally {
      if (!isInitialLoad) {
        this.loadingSignal.set(false);
      }
    }
  }

  /**
   * –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —è–∑—ã–∫–∞ —Å —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–º
   */
  switchToLanguage(targetLang: string): void {
    if (!this.isLanguageSupported(targetLang)) {
      console.warn(`Cannot switch to unsupported language: ${targetLang}`);
      return;
    }

    const targetDomain = this.getDomainForLanguage(targetLang);

    if (targetDomain && targetDomain !== this.browserService.hostname) {
      const currentPath = this.browserService.pathname + this.browserService.search;
      this.browserService.redirect(`https://${targetDomain}${currentPath}`);
    } else {
      this.setLanguage(targetLang);
    }
  }

  /**
   * –ü–æ–ª—É—á–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥ –ø–æ –∫–ª—é—á—É
   */
  translate(key: string, params?: Record<string, any>): string {
    const translations = this.currentTranslations();
    let translation = this.getNestedValue(translations, key);

    if (!translation) {
      const fallbackTranslations = this.translationsSignal()[this.config.fallbackLanguage];
      if (fallbackTranslations) {
        translation = this.getNestedValue(fallbackTranslations, key);
      }
    }

    if (!translation) {
      console.warn(`Translation not found for key: ${key} in ${this.currentLang()}`);
      return key;
    }

    return this.interpolateParams(translation, params);
  }

  // Private helper methods
  private isLanguageSupported(lang: string): boolean {
    return this.availableLanguages().includes(lang);
  }

  private getDomainForLanguage(lang: string): string | undefined {
    return Object.entries(this.domainMap).find(([domain, language]) => language === lang)?.[0];
  }

  private getNestedValue(obj: any, path: string): string | null {
    const keys = path.split(".");
    let current = obj;

    for (const key of keys) {
      if (current && typeof current === "object" && key in current) {
        current = current[key];
      } else {
        return null;
      }
    }

    return typeof current === "string" ? current : null;
  }

  private interpolateParams(text: string, params?: Record<string, any>): string {
    if (!params) return text;

    return text.replace(/\{\{(\w+)\}\}/g, (match, key) => {
      return params[key]?.toString() ?? match;
    });
  }
}

// ============================================================================
// üîí INTERNAL CONFIG INTERFACE
// ============================================================================

interface InternalI18nConfig {
  domainMap: Record<string, string>;
  supportedLanguages: string[];
  defaultLanguage: string;
  fallbackLanguage: string;
  translationsPath: string;
  enableLanguageMeta: boolean;
  languageResolver?: LanguageResolver;
  onLanguageChange?: (from: string, to: string) => void | Promise<void>;
}
```

### 3.2 Language Info Provider (–ù–û–í–ê–Ø –ê–ë–°–¢–†–ê–ö–¶–ò–Ø)

```typescript
// ============================================================================
// üåç LANGUAGE INFO PROVIDER - –†–∞—Å—à–∏—Ä—è–µ–º–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —è–∑—ã–∫–∞—Ö
// ============================================================================

/**
 * –ü—Ä–æ–≤–∞–π–¥–µ—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ —è–∑—ã–∫–∞–º–∏
 * –ú–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–º–µ–Ω–µ–Ω –≤ Advanced API
 */
@Injectable()
export class DefaultLanguageInfoProvider implements LanguageInfoProvider {
  // –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —è–∑—ã–∫–∞—Ö (–±–µ–∑ —Ö–∞—Ä–¥–∫–æ–¥–∞ –≤ core)
  private readonly DEFAULT_LANGUAGE_DATA: Record<string, Omit<LanguageInfo, "code" | "domain">> = {
    en: { name: "English", nativeName: "English", flag: "üá∫üá∏", defaultLocale: "en_US" },
    de: { name: "German", nativeName: "Deutsch", flag: "üá©üá™", defaultLocale: "de_DE" },
    fr: { name: "French", nativeName: "Fran√ßais", flag: "üá´üá∑", defaultLocale: "fr_FR" },
    es: { name: "Spanish", nativeName: "Espa√±ol", flag: "üá™üá∏", defaultLocale: "es_ES" },
    it: { name: "Italian", nativeName: "Italiano", flag: "üáÆüáπ", defaultLocale: "it_IT" },
    pl: { name: "Polish", nativeName: "Polski", flag: "üáµüá±", defaultLocale: "pl_PL" },
    ru: { name: "Russian", nativeName: "–†—É—Å—Å–∫–∏–π", flag: "üá∑üá∫", defaultLocale: "ru_RU" },
    uk: { name: "Ukrainian", nativeName: "–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞", flag: "üá∫üá¶", defaultLocale: "uk_UA" },
    ja: { name: "Japanese", nativeName: "Êó•Êú¨Ë™û", flag: "üáØüáµ", defaultLocale: "ja_JP" },
    zh: { name: "Chinese", nativeName: "‰∏≠Êñá", flag: "üá®üá≥", defaultLocale: "zh_CN" },
    pt: { name: "Portuguese", nativeName: "Portugu√™s", flag: "üáµüáπ", defaultLocale: "pt_PT" },
    nl: { name: "Dutch", nativeName: "Nederlands", flag: "üá≥üá±", defaultLocale: "nl_NL" },
    sv: { name: "Swedish", nativeName: "Svenska", flag: "üá∏üá™", defaultLocale: "sv_SE" },
    da: { name: "Danish", nativeName: "Dansk", flag: "üá©üá∞", defaultLocale: "da_DK" },
    no: { name: "Norwegian", nativeName: "Norsk", flag: "üá≥üá¥", defaultLocale: "no_NO" },
    fi: { name: "Finnish", nativeName: "Suomi", flag: "üá´üáÆ", defaultLocale: "fi_FI" },
  };

  getLanguageInfo(languageCodes: string[], domainMap: Record<string, string>): LanguageInfo[] {
    return languageCodes.map((lang) => {
      const domain = this.getDomainForLanguage(lang, domainMap);
      const info = this.DEFAULT_LANGUAGE_DATA[lang];

      return {
        code: lang,
        domain: domain || "",
        name: info?.name || this.capitalizeLanguageCode(lang),
        nativeName: info?.nativeName || this.capitalizeLanguageCode(lang),
        flag: info?.flag || "üåê",
        defaultLocale: info?.defaultLocale || `${lang}_${lang.toUpperCase()}`,
      };
    });
  }

  private getDomainForLanguage(lang: string, domainMap: Record<string, string>): string | undefined {
    return Object.entries(domainMap).find(([domain, language]) => language === lang)?.[0];
  }

  private capitalizeLanguageCode(lang: string): string {
    return lang.charAt(0).toUpperCase() + lang.slice(1);
  }
}

/**
 * –ü—Ä–∏–º–µ—Ä –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –¥–ª—è enterprise —Å–ª—É—á–∞–µ–≤
 */
@Injectable()
export class EnterpriseLanguageInfoProvider implements LanguageInfoProvider {
  constructor(private http: HttpClient) {}

  async getLanguageInfo(languageCodes: string[], domainMap: Record<string, string>): Promise<LanguageInfo[]> {
    // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ API, –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –∏–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
    const response = await firstValueFrom(
      this.http.get<any[]>("/api/languages/info", {
        params: { codes: languageCodes.join(",") },
      })
    );

    return response.map((apiLang) => ({
      code: apiLang.code,
      name: apiLang.englishName,
      nativeName: apiLang.nativeName,
      flag: apiLang.flagEmoji,
      domain: this.getDomainForLanguage(apiLang.code, domainMap) || "",
      defaultLocale: apiLang.locale,
    }));
  }

  private getDomainForLanguage(lang: string, domainMap: Record<string, string>): string | undefined {
    return Object.entries(domainMap).find(([domain, language]) => language === lang)?.[0];
  }
}
```

### 3.3 Browser Service (SSR-safe)

```typescript
@Injectable({ providedIn: "root" })
export class BrowserService {
  private get isBrowser(): boolean {
    return typeof window !== "undefined" && typeof document !== "undefined";
  }

  get hostname(): string {
    return this.isBrowser ? window.location.hostname : "";
  }

  get pathname(): string {
    return this.isBrowser ? window.location.pathname : "";
  }

  get search(): string {
    return this.isBrowser ? window.location.search : "";
  }

  redirect(url: string): void {
    if (this.isBrowser) {
      window.location.href = url;
    }
  }

  getLocalStorage(key: string): string | null {
    if (!this.isBrowser) return null;
    try {
      return localStorage?.getItem(key) ?? null;
    } catch {
      return null;
    }
  }

  setLocalStorage(key: string, value: string): void {
    if (!this.isBrowser) return;
    try {
      localStorage?.setItem(key, value);
    } catch {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ storage
    }
  }

  removeLocalStorage(key: string): void {
    if (!this.isBrowser) return;
    try {
      localStorage?.removeItem(key);
    } catch {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
    }
  }
}
```

### 3.4 Default Implementations

```typescript
// ============================================================================
// üè∑Ô∏è DEFAULT IMPLEMENTATIONS
// ============================================================================

@Injectable()
export class DefaultLanguageMetaAdapter implements LanguageMetaAdapter {
  constructor(private browserService: BrowserService) {}

  updateHtmlLang(lang: string): void {
    if (typeof document !== "undefined") {
      document.documentElement.lang = lang;
    }
  }

  updateMetaTags(lang: string): void {
    if (typeof document === "undefined") return;

    const languageInfo = this.getLanguageInfo(lang);

    this.updateOrCreateMeta('name="language"', lang);
    this.updateOrCreateMeta('property="og:locale"', languageInfo.defaultLocale);
  }

  generateHreflangLinks(languages: LanguageInfo[]): void {
    if (typeof document === "undefined") return;

    // –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ hreflang links
    document.querySelectorAll("link[hreflang]").forEach((link) => link.remove());

    const currentPath = this.browserService.pathname + this.browserService.search;

    languages.forEach((lang) => {
      if (!lang.domain) return;

      const link = document.createElement("link");
      link.rel = "alternate";
      link.hreflang = lang.code;
      link.href = `https://${lang.domain}${currentPath}`;
      document.head.appendChild(link);
    });

    if (languages.length > 0 && languages[0].domain) {
      const defaultLink = document.createElement("link");
      defaultLink.rel = "alternate";
      defaultLink.hreflang = "x-default";
      defaultLink.href = `https://${languages[0].domain}${currentPath}`;
      document.head.appendChild(defaultLink);
    }
  }

  private updateOrCreateMeta(selector: string, content: string): void {
    if (typeof document === "undefined") return;

    let meta = document.querySelector(`meta[${selector}]`) as HTMLMetaElement;

    if (!meta) {
      meta = document.createElement("meta");

      if (selector.includes("name=")) {
        const name = selector.match(/name="([^"]+)"/)?.[1];
        if (name) meta.name = name;
      } else if (selector.includes("property=")) {
        const property = selector.match(/property="([^"]+)"/)?.[1];
        if (property) meta.setAttribute("property", property);
      }

      document.head.appendChild(meta);
    }

    meta.content = content;
  }

  private getLanguageInfo(lang: string): { defaultLocale: string } {
    const localeMap: Record<string, string> = {
      en: "en_US",
      de: "de_DE",
      fr: "fr_FR",
      es: "es_ES",
      it: "it_IT",
      pl: "pl_PL",
      ru: "ru_RU",
      uk: "uk_UA",
      ja: "ja_JP",
      zh: "zh_CN",
      pt: "pt_PT",
      nl: "nl_NL",
      sv: "sv_SE",
      da: "da_DK",
      no: "no_NO",
      fi: "fi_FI",
    };

    return {
      defaultLocale: localeMap[lang] || `${lang}_${lang.toUpperCase()}`,
    };
  }
}

@Injectable()
export class LocalStorageStrategy implements StorageStrategy {
  private readonly STORAGE_KEY = "aurora-i18n-lang";

  constructor(private browserService: BrowserService) {}

  get(): string | null {
    return this.browserService.getLocalStorage(this.STORAGE_KEY);
  }

  set(lang: string): void {
    this.browserService.setLocalStorage(this.STORAGE_KEY, lang);
  }

  clear(): void {
    this.browserService.removeLocalStorage(this.STORAGE_KEY);
  }
}

@Injectable()
export class HttpTranslationLoader implements TranslationLoader {
  constructor(private http: HttpClient, @Inject(I18N_CONFIG) private config: InternalI18nConfig) {}

  async load(lang: string): Promise<Translations> {
    try {
      const url = `${this.config.translationsPath}/${lang}.json`;

      return await firstValueFrom(this.http.get<Translations>(url).pipe(timeout(10000), retry(2)));
    } catch (error) {
      throw new Error(`Translation loading failed for language: ${lang}`);
    }
  }
}
```

## 4. Pipes –∏ Components

### 4.1 Translation Pipe

```typescript
@Pipe({
  name: "t",
  standalone: true,
  pure: false, // required: reacts to signal-based language changes
})
export class TranslationPipe implements PipeTransform, OnDestroy {
  private translationService = inject(TranslationService);
  private cache = new Map<string, string>();
  private lastLang = "";

  transform(key: string, params?: Record<string, any>): string {
    const currentLang = this.translationService.currentLang();

    // –û—á–∏—â–∞–µ–º –∫–µ—à –ø—Ä–∏ —Å–º–µ–Ω–µ —è–∑—ã–∫–∞
    if (currentLang !== this.lastLang) {
      this.cache.clear();
      this.lastLang = currentLang;
    }

    const cacheKey = params ? `${currentLang}:${key}:${JSON.stringify(params)}` : `${currentLang}:${key}`;

    if (this.cache.has(cacheKey)) {
      return this.cache.get(cacheKey)!;
    }

    const translation = this.translationService.translate(key, params);

    if (translation !== key) {
      this.cache.set(cacheKey, translation);
    }

    return translation;
  }

  ngOnDestroy(): void {
    this.cache.clear();
  }
}
```

### 4.2 Basic Language Switcher Component

```typescript
// ============================================================================
// üåç BASIC LANGUAGE SWITCHER - Reference Implementation
// ============================================================================

/**
 * @deprecated –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ ng-zorro –∏–ª–∏ material –≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–ª—è production
 * –≠—Ç–æ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞
 */
@Component({
  selector: "aurora-language-switcher-basic",
  standalone: true,
  imports: [CommonModule, TranslationPipe],
  template: `
    <div class="aurora-language-switcher-basic">
      <!-- Reference implementation warning -->
      <div class="reference-warning" *ngIf="showWarning">‚ö†Ô∏è Using basic reference component. Consider ng-zorro or material variants for production.</div>

      <button type="button" class="current-language" [disabled]="translationService.isLoading()" (click)="toggleDropdown()" [attr.aria-expanded]="isOpen">
        @if (translationService.isLoading()) {
        <div class="loading-spinner"></div>
        } @else {
        <span class="flag">{{ getCurrentLanguage().flag }}</span>
        }

        <span class="language-name">{{ getCurrentLanguage().nativeName }}</span>

        <svg class="chevron" [class.open]="isOpen" width="12" height="8" viewBox="0 0 12 8">
          <path d="M1 1l5 5 5-5" stroke="currentColor" fill="none" stroke-width="1.5" />
        </svg>
      </button>

      @if (isOpen) {
      <div class="language-dropdown" (click)="$event.stopPropagation()">
        @for (lang of availableLanguages(); track lang.code) {
        <button type="button" class="language-option" [class.current]="lang.code === currentLang()" [class.different-domain]="isDifferentDomain(lang)" (click)="selectLanguage(lang.code)">
          <div class="language-info">
            <span class="flag">{{ lang.flag }}</span>
            <span class="name">{{ lang.nativeName }}</span>
            @if (isDifferentDomain(lang)) {
            <small class="domain-hint">{{ lang.domain }}</small>
            }
          </div>

          @if (lang.code === currentLang()) {
          <svg class="checkmark" width="16" height="16" viewBox="0 0 16 16">
            <path d="M13.5 4L6 11.5L2.5 8" stroke="currentColor" fill="none" stroke-width="2" />
          </svg>
          }
        </button>
        }
      </div>
      }
    </div>
  `,
  styles: [
    `
      .reference-warning {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        color: #856404;
        padding: 8px;
        border-radius: 4px;
        font-size: 12px;
        margin-bottom: 8px;
      }

      .aurora-language-switcher-basic {
        position: relative;
        display: inline-block;
      }

      .current-language {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 12px;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        background: #ffffff;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.15s ease;
      }

      .current-language:hover:not(:disabled) {
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }

      .loading-spinner {
        width: 16px;
        height: 16px;
        border: 2px solid #e5e7eb;
        border-top: 2px solid #3b82f6;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      .language-dropdown {
        position: absolute;
        top: 100%;
        right: 0;
        min-width: 200px;
        background: #ffffff;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        margin-top: 4px;
      }

      .language-option {
        display: flex;
        align-items: center;
        justify-content: space-between;
        width: 100%;
        padding: 12px 16px;
        border: none;
        background: none;
        cursor: pointer;
        transition: background-color 0.15s;
      }

      .language-option:hover {
        background-color: #f9fafb;
      }

      .language-option.current {
        background-color: #eff6ff;
        color: #1d4ed8;
      }

      .language-option.different-domain {
        border-left: 3px solid #f59e0b;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    `,
  ],
})
export class BasicLanguageSwitcherComponent {
  @Input() showWarning = true; // –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

  protected translationService = inject(TranslationService);
  protected isOpen = false;

  protected currentLang = this.translationService.currentLang;
  protected availableLanguages = this.translationService.languageInfo;

  @HostListener("document:click")
  closeDropdown(): void {
    this.isOpen = false;
  }

  protected toggleDropdown(): void {
    if (this.translationService.isLoading()) return;
    this.isOpen = !this.isOpen;
  }

  protected selectLanguage(lang: string): void {
    this.translationService.switchToLanguage(lang);
    this.isOpen = false;
  }

  protected getCurrentLanguage(): LanguageInfo {
    const current = this.currentLang();
    const available = this.availableLanguages();
    return (
      available.find((lang) => lang.code === current) ||
      available[0] || {
        code: current,
        name: current,
        nativeName: current,
        flag: "üåê",
        domain: "",
        defaultLocale: `${current}_${current.toUpperCase()}`,
      }
    );
  }

  protected isDifferentDomain(lang: LanguageInfo): boolean {
    return typeof window !== "undefined" && lang.domain && lang.domain !== window.location.hostname;
  }
}
```

## 5. Provider Functions (–ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï)

### 5.1 Simple Provider

```typescript
export function provideAuroraI18n(
  domainMap: Record<string, string>,
  options: {
    translationsPath?: string;
    fallbackLanguage?: string;
    enableLanguageMeta?: boolean;
  } = {}
): Provider[] {
  if (!domainMap || Object.keys(domainMap).length === 0) {
    throw new Error("Aurora i18n: domainMap cannot be empty");
  }

  const config = createInternalConfig(domainMap, options);

  return [
    { provide: I18N_DOMAIN_MAP, useValue: domainMap },
    { provide: I18N_CONFIG, useValue: config },

    BrowserService,
    { provide: LanguageMetaAdapter, useClass: DefaultLanguageMetaAdapter },
    { provide: StorageStrategy, useClass: LocalStorageStrategy },
    { provide: TranslationLoader, useClass: HttpTranslationLoader },
    { provide: LanguageInfoProvider, useClass: DefaultLanguageInfoProvider },
    TranslationService,

    {
      provide: APP_INITIALIZER,
      useFactory: (service: TranslationService) => () => service.initialize(),
      deps: [TranslationService],
      multi: true,
    },
  ];
}

function createInternalConfig(domainMap: Record<string, string>, options: any): InternalI18nConfig {
  const supportedLanguages = [...new Set(Object.values(domainMap))];
  const defaultLanguage = supportedLanguages[0] || "en";

  return {
    domainMap,
    supportedLanguages,
    defaultLanguage,
    fallbackLanguage: options.fallbackLanguage || defaultLanguage,
    translationsPath: options.translationsPath || "/assets/i18n",
    enableLanguageMeta: options.enableLanguageMeta ?? true,
  };
}
```

### 5.2 Advanced Provider (–ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô)

```typescript
export function provideAuroraI18nAdvanced(config: { domainMap: Record<string, string>; languageResolver?: LanguageResolver; metaAdapter?: LanguageMetaAdapter; storageStrategy?: StorageStrategy; translationLoader?: TranslationLoader; languageInfoProvider?: LanguageInfoProvider; onLanguageChange?: (from: string, to: string) => void | Promise<void> }): Provider[] {
  if (!config.domainMap || Object.keys(config.domainMap).length === 0) {
    throw new Error("Aurora i18n: domainMap cannot be empty");
  }

  const internalConfig = createAdvancedInternalConfig(config);

  return [
    { provide: I18N_DOMAIN_MAP, useValue: config.domainMap },
    { provide: I18N_CONFIG, useValue: internalConfig },

    BrowserService,
    // –ò–°–ü–†–ê–í–õ–ï–ù–û: –∏—Å–ø–æ–ª—å–∑—É–µ–º useFactory –≤–º–µ—Å—Ç–æ useValue + inject()
    {
      provide: LanguageMetaAdapter,
      useFactory: () => config.metaAdapter ?? new DefaultLanguageMetaAdapter(inject(BrowserService)),
    },
    {
      provide: StorageStrategy,
      useFactory: () => config.storageStrategy ?? new LocalStorageStrategy(inject(BrowserService)),
    },
    {
      provide: TranslationLoader,
      useFactory: () => config.translationLoader ?? new HttpTranslationLoader(inject(HttpClient), inject(I18N_CONFIG)),
    },
    {
      provide: LanguageInfoProvider,
      useFactory: () => config.languageInfoProvider ?? new DefaultLanguageInfoProvider(),
    },

    TranslationService,

    {
      provide: APP_INITIALIZER,
      useFactory: (service: TranslationService) => () => service.initialize(),
      deps: [TranslationService],
      multi: true,
    },
  ];
}

function createAdvancedInternalConfig(config: any): InternalI18nConfig {
  const supportedLanguages = [...new Set(Object.values(config.domainMap))];
  const defaultLanguage = supportedLanguages[0] || "en";

  return {
    domainMap: config.domainMap,
    supportedLanguages,
    defaultLanguage,
    fallbackLanguage: defaultLanguage,
    translationsPath: "/assets/i18n",
    enableLanguageMeta: true,
    languageResolver: config.languageResolver,
    onLanguageChange: config.onLanguageChange,
  };
}
```

## 6. Injection Tokens

```typescript
export const I18N_DOMAIN_MAP = new InjectionToken<Record<string, string>>("I18N_DOMAIN_MAP");
export const I18N_CONFIG = new InjectionToken<InternalI18nConfig>("I18N_CONFIG");
```

## 7. Public API Exports

```typescript
// ============================================================================
// üìÑ PUBLIC API - public-api.ts
// ============================================================================

// Core functions
export { provideAuroraI18n, provideAuroraI18nAdvanced } from "./lib/providers";

// Services (for advanced usage)
export { TranslationService } from "./lib/services/translation.service";
export { BrowserService } from "./lib/services/browser.service";

// Components
export { BasicLanguageSwitcherComponent } from "./lib/components/basic-language-switcher.component";

// Pipes
export { TranslationPipe } from "./lib/pipes/translation.pipe";

// Interfaces for extensibility
export { LanguageResolver, LanguageMetaAdapter, StorageStrategy, TranslationLoader, LanguageInfoProvider, LanguageInfo, Translations } from "./lib/interfaces";

// Default implementations (for custom providers)
export { DefaultLanguageMetaAdapter } from "./lib/adapters/default-language-meta.adapter";
export { LocalStorageStrategy } from "./lib/strategies/local-storage.strategy";
export { HttpTranslationLoader } from "./lib/loaders/http-translation.loader";
export { DefaultLanguageInfoProvider, EnterpriseLanguageInfoProvider } from "./lib/providers/language-info.provider";

// Tokens (for custom injection)
export { I18N_DOMAIN_MAP, I18N_CONFIG } from "./lib/tokens";
```

## 8. Micro-CLI

```typescript
#!/usr/bin/env node
// bin/cli.js

import { writeFileSync, mkdirSync, existsSync } from "fs";
import { join } from "path";

function init() {
  console.log("üöÄ Initializing @aurora/i18n...\n");

  try {
    // 1. –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤
    const i18nDir = "src/assets/i18n";
    if (!existsSync(i18nDir)) {
      mkdirSync(i18nDir, { recursive: true });
      console.log(`‚úÖ Created directory: ${i18nDir}`);
    }

    // 2. –°–æ–∑–¥–∞–µ–º –±–∞–∑–æ–≤—ã–µ —Ñ–∞–π–ª—ã –ø–µ—Ä–µ–≤–æ–¥–æ–≤
    const translations = {
      en: {
        AURORA_I18N: {
          SELECT_LANGUAGE: "Select language",
          SWITCH_TO: "Switch to {{language}}",
        },
        COMMON: {
          LOADING: "Loading...",
          ERROR: "Something went wrong",
          SUCCESS: "Success!",
          SAVE: "Save",
          CANCEL: "Cancel",
        },
        HEADER: {
          TITLE: "My Application",
          MENU: {
            HOME: "Home",
            ABOUT: "About",
            CONTACT: "Contact",
          },
        },
      },
      de: {
        AURORA_I18N: {
          SELECT_LANGUAGE: "Sprache w√§hlen",
          SWITCH_TO: "Wechseln zu {{language}}",
        },
        COMMON: {
          LOADING: "L√§dt...",
          ERROR: "Etwas ist schief gelaufen",
          SUCCESS: "Erfolgreich!",
          SAVE: "Speichern",
          CANCEL: "Abbrechen",
        },
        HEADER: {
          TITLE: "Meine Anwendung",
          MENU: {
            HOME: "Startseite",
            ABOUT: "√úber uns",
            CONTACT: "Kontakt",
          },
        },
      },
    };

    Object.entries(translations).forEach(([lang, content]) => {
      const filePath = join(i18nDir, `${lang}.json`);
      if (!existsSync(filePath)) {
        writeFileSync(filePath, JSON.stringify(content, null, 2));
        console.log(`‚úÖ Created: ${filePath}`);
      }
    });

    // 3. –°–æ–∑–¥–∞–µ–º example –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
    const configExample = `
import { provideAuroraI18n } from '@aurora/i18n';

export const i18nProviders = provideAuroraI18n({
  'localhost': 'en',
  'localhost:4200': 'en',
  'myapp.com': 'en',
  'myapp.de': 'de'
});

// Add to main.ts providers: [...i18nProviders]
// Use in templates: {{ 'HEADER.TITLE' | t }}
// Add language switcher: <aurora-language-switcher-basic></aurora-language-switcher-basic>
`.trim();

    writeFileSync("i18n.example.ts", configExample);
    console.log(`‚úÖ Created: i18n.example.ts`);

    console.log("\nüéØ Next steps:");
    console.log("  1. Add providers to main.ts (see i18n.example.ts)");
    console.log('  2. Use {{ "KEY" | t }} in templates');
    console.log("  3. Add <aurora-language-switcher-basic></aurora-language-switcher-basic>");
    console.log("  4. Consider ng-zorro or material variants for production UI");
  } catch (error) {
    console.error("‚ùå Error during initialization:", error.message);
    process.exit(1);
  }
}

// Run if called directly
if (import.meta.url === `file://${process.argv[1]}`) {
  init();
}
```

## 9. Package Configuration

```json
{
  "name": "@aurora/i18n",
  "version": "2.2.0",
  "description": "Simple, powerful i18n for Angular with domain-based localization",
  "keywords": ["angular", "i18n", "translation", "domain-based", "signals"],
  "main": "./fesm2022/aurora-i18n.mjs",
  "types": "./aurora-i18n.d.ts",
  "exports": {
    ".": {
      "types": "./aurora-i18n.d.ts",
      "esm2022": "./esm2022/aurora-i18n.mjs",
      "fesm2022": "./fesm2022/aurora-i18n.mjs",
      "default": "./fesm2022/aurora-i18n.mjs"
    }
  },
  "peerDependencies": {
    "@angular/common": ">=17.0.0",
    "@angular/core": ">=17.0.0",
    "rxjs": ">=7.8.0"
  },
  "bin": {
    "aurora-i18n": "./bin/cli.js"
  },
  "sideEffects": false
}
```

## 10. –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 10.1 Simple Setup

```typescript
// main.ts
bootstrapApplication(AppComponent, {
  providers: [
    provideAuroraI18n({
      "myapp.com": "en",
      "myapp.de": "de",
    }),
  ],
});
```

### 10.2 Advanced Setup —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º LanguageInfoProvider

```typescript
// enterprise-i18n.ts
class CustomLanguageInfoProvider implements LanguageInfoProvider {
  getLanguageInfo(codes: string[], domainMap: Record<string, string>): LanguageInfo[] {
    // –ö–∞—Å—Ç–æ–º–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è —Ñ–ª–∞–≥–æ–≤, –ª–æ–∫–∞–ª–µ–π, –Ω–∞–∑–≤–∞–Ω–∏–π
    return codes.map((code) => ({
      code,
      name: this.getCustomName(code),
      nativeName: this.getCustomNativeName(code),
      flag: this.getCustomFlag(code), // –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Ñ–ª–∞–≥–∏
      domain: this.getDomain(code, domainMap),
      defaultLocale: this.getCustomLocale(code),
    }));
  }
}

provideAuroraI18nAdvanced({
  domainMap: { "corp.com": "en", "corp.de": "de" },
  languageInfoProvider: new CustomLanguageInfoProvider(),
  onLanguageChange: (from, to) => analytics.track("language_changed", { from, to }),
});
```

## 11. Success Metrics

### 11.1 Technical

- **Bundle size**: < 8KB gzipped
- **Memory usage**: < 5 languages cached
- **Performance**: APP_INITIALIZER prevents FOUC
- **SSR compatibility**: 100%
- **Extensibility**: LanguageInfoProvider allows custom language data

### 11.2 Developer Experience

- **Setup time**: < 60 seconds
- **Learning curve**: < 15 minutes
- **API surface**: 2 main functions
- **Customization**: Pluggable providers for all aspects

---

## ‚úÖ Critical Fixes Applied (v2.2)

1. **üîß FIXED: inject() in useValue** - Changed to useFactory with proper dependencies
2. **üîß FIXED: LanguageResolver unused** - Integrated into detectLanguage()
3. **üîß FIXED: Hardcoded 'en' fallback** - Uses config.fallbackLanguage with explanatory comments
4. **üîß ADDED: Memory management** - Limited translation cache to 5 languages
5. **üîß ADDED: LanguageInfoProvider abstraction** - No more hardcoded language data in core
6. **üîß RENAMED: BasicLanguageSwitcherComponent** - Marked as reference implementation
7. **üîß DOCUMENTED: Domain language restrictions** - Added intentional behavior comments

**Ready for production implementation! üöÄ**
