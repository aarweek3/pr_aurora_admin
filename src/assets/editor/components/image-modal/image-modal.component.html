<div class="modal-backdrop" *ngIf="isOpen" (click)="close()"></div>

<div #modalWindow class="image-modal" *ngIf="isOpen" (click)="$event.stopPropagation()" [ngStyle]="getModalStyle()">
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- DIV 1: Header -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="modal-header" (mousedown)="onModalHeaderMouseDown($event)" [class.dragging]="isDraggingModal">
    <h2>–í—Å—Ç–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</h2>
    <button class="aurora-btn-close" (click)="close()" aria-label="–ó–∞–∫—Ä—ã—Ç—å">√ó</button>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- DIV 2: Navigation + Actions -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="modal-navigation">
    <!-- –õ–µ–≤–∞—è —á–∞—Å—Ç—å: –≤–∫–ª–∞–¥–∫–∏ -->
    <div class="nav-tabs">
      <button
        class="aurora-btn aurora-btn-ghost aurora-btn-sm"
        [class.aurora-btn-active]="activeTab === 'upload'"
        (click)="switchTab('upload')"
      >
        üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å
      </button>
      <button
        class="aurora-btn aurora-btn-ghost aurora-btn-sm"
        [class.aurora-btn-active]="activeTab === 'crop'"
        (click)="switchTab('crop')"
        [disabled]="!previewUrl"
      >
        ‚úÇÔ∏è –û–±—Ä–µ–∑–∞—Ç—å
      </button>
      <button
        class="aurora-btn aurora-btn-ghost aurora-btn-sm"
        [class.aurora-btn-active]="activeTab === 'circle'"
        (click)="switchTab('circle')"
        [disabled]="!previewUrl"
      >
        ‚≠ï –ö—Ä—É–≥
      </button>
      <button
        class="aurora-btn aurora-btn-ghost aurora-btn-sm"
        [class.aurora-btn-active]="activeTab === 'frame'"
        (click)="switchTab('frame')"
        [disabled]="!previewUrl"
      >
        üñºÔ∏è –†–∞–º–∫–∞
      </button>
      <button
        class="aurora-btn aurora-btn-ghost aurora-btn-sm"
        [class.aurora-btn-active]="activeTab === 'edit'"
        (click)="switchTab('edit')"
        [disabled]="!previewUrl"
      >
        üé® –û–±—Ä–∞–±–æ—Ç–∫–∞
      </button>
      <button
        class="aurora-btn aurora-btn-ghost aurora-btn-sm"
        [class.aurora-btn-active]="activeTab === 'watermark'"
        (click)="switchTab('watermark')"
        [disabled]="!previewUrl"
      >
        üíß –í–æ–¥—è–Ω–æ–π –∑–Ω–∞–∫
      </button>
      <button
        class="aurora-btn aurora-btn-ghost aurora-btn-sm"
        [class.aurora-btn-active]="activeTab === 'settings'"
        (click)="switchTab('settings')"
        [disabled]="!previewUrl"
      >
        ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏
      </button>
    </div>

    <!-- –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å: –¥–µ–π—Å—Ç–≤–∏—è -->
    <div class="nav-actions">
      <button class="aurora-btn aurora-btn-ghost aurora-btn-md" (click)="close()" [disabled]="uploadState.isUploading">
        –û—Ç–º–µ–Ω–∞
      </button>
      <button
        class="aurora-btn aurora-btn-primary aurora-btn-md"
        (click)="applyAndInsert()"
        [disabled]="!previewUrl || uploadState.isUploading"
      >
        <span *ngIf="!uploadState.isUploading">–í—Å—Ç–∞–≤–∏—Ç—å</span>
        <span *ngIf="uploadState.isUploading">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...</span>
      </button>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- DIV 3: Body (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫) -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="modal-body">
    <!-- DIV 3.1: Canvas Area (1/3) -->
    <div class="body-canvas" #bodyCanvas>
      <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –º–µ–Ω—è–µ—Ç—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–∫–ª–∞–¥–∫–∏ -->

      <!-- Upload: –ü—Ä–µ–≤—å—é –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
      <ng-container *ngIf="activeTab === 'upload'">
        <div *ngIf="previewUrl" class="upload-container">
          <div class="canvas-wrapper">
            <canvas #uploadCanvas></canvas>
          </div>
        </div>
        <div *ngIf="!previewUrl" class="canvas-placeholder">
          <span class="placeholder-icon">üñºÔ∏è</span>
          <p class="placeholder-text">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å</p>
        </div>
      </ng-container>

      <!-- Crop: Canvas —Å overlay -->
      <ng-container *ngIf="activeTab === 'crop'">
        <div class="crop-container">
          <div class="canvas-wrapper">
            <canvas #cropCanvas></canvas>
            <canvas #cropOverlay class="crop-overlay"></canvas>
          </div>
        </div>
      </ng-container>

      <!-- Circle: Canvas —Å –∫—Ä—É–≥–æ–≤–æ–π –æ–±—Ä–µ–∑–∫–æ–π -->
      <ng-container *ngIf="activeTab === 'circle'">
        <div class="circle-container">
          <div class="canvas-wrapper">
            <canvas #circleCanvas></canvas>
            <canvas #circleOverlay class="circle-overlay"></canvas>
          </div>
        </div>
      </ng-container>

      <!-- Frame: Canvas —Å —Ä–∞–º–∫–∞–º–∏ -->
      <ng-container *ngIf="activeTab === 'frame'">
        <div class="frame-container">
          <div class="canvas-wrapper">
            <canvas #frameCanvas class="frame-canvas"></canvas>
          </div>
        </div>
      </ng-container>

      <!-- Edit: Canvas —Å —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏ -->
      <ng-container *ngIf="activeTab === 'edit'">
        <img
          [src]="imageData.current || previewUrl"
          alt="–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ"
          [style.filter]="
            'brightness(' +
            (100 + brightness) +
            '%) ' +
            'contrast(' +
            (100 + contrast) +
            '%) ' +
            'saturate(' +
            (100 + saturation) +
            '%) ' +
            'hue-rotate(' +
            hueRotate +
            'deg) ' +
            'blur(' +
            blur +
            'px) ' +
            'grayscale(' +
            grayscale +
            '%) ' +
            'sepia(' +
            sepia +
            '%) ' +
            'invert(' +
            invert +
            '%)'
          "
        />
        <div class="canvas-badge" *ngIf="legacyCroppedDimensions">
          {{ legacyCroppedDimensions.width }}√ó{{ legacyCroppedDimensions.height }}px
        </div>
      </ng-container>

      <!-- Watermark: Canvas —Å preview –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞ -->
      <ng-container *ngIf="activeTab === 'watermark'">
        <div class="watermark-preview-container">
          <canvas #watermarkCanvas class="watermark-canvas"></canvas>
        </div>
      </ng-container>

      <!-- Settings: –§–∏–Ω–∞–ª—å–Ω–æ–µ –ø—Ä–µ–≤—å—é -->
      <ng-container *ngIf="activeTab === 'settings'">
        <figure [attr.data-align]="config.alignment" [attr.data-width]="config.width" class="aurora-image">
          <img [src]="previewUrl" [alt]="config.alt || ''" />
          <figcaption *ngIf="config.caption">{{ config.caption }}</figcaption>
        </figure>
      </ng-container>
    </div>

    <!-- DIV 3.2: Controls Panel (2/3 –∏–ª–∏ flex:1) -->
    <div class="body-controls">
      <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –º–µ–Ω—è–µ—Ç—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–∫–ª–∞–¥–∫–∏ -->

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê UPLOAD TAB ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <ng-container *ngIf="activeTab === 'upload'">
        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∞–π–ª–µ -->
        <div class="file-info" *ngIf="previewUrl">
          <h4>üìÅ {{ imageFileName }}</h4>
          <p>{{ formatFileSize(imageFileSize) }}</p>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ - –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–µ–Ω—é -->
        <div class="source-buttons-horizontal">
          <button
            class="aurora-btn aurora-btn-ghost aurora-btn-sm"
            [class.aurora-btn-active]="sourceType === 'file'"
            (click)="sourceType = 'file'"
          >
            <span class="btn-icon">üìÑ</span>
            <span class="btn-label">–§–∞–π–ª</span>
          </button>
          <button
            class="aurora-btn aurora-btn-ghost aurora-btn-sm"
            [class.aurora-btn-active]="sourceType === 'url'"
            (click)="sourceType = 'url'"
          >
            <span class="btn-icon">üîó</span>
            <span class="btn-label">URL</span>
          </button>
          <button
            class="aurora-btn aurora-btn-ghost aurora-btn-sm"
            [class.aurora-btn-active]="sourceType === 'drop'"
            (click)="sourceType = 'drop'"
          >
            <span class="btn-icon">üì•</span>
            <span class="btn-label">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç—å</span>
          </button>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞ -->
        <div class="source-content">
          <!-- File Input -->
          <div *ngIf="sourceType === 'file'" class="source-section">
            <input type="file" #fileInput accept="image/*" (change)="onFileSelected($event)" style="display: none" />
            <button (click)="fileInput.click()" class="aurora-btn aurora-btn-primary aurora-btn-md aurora-btn-w-full">
              üìÅ –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª
            </button>
            <p class="source-hint">JPEG, PNG, GIF, WebP</p>
          </div>

          <!-- URL Input -->
          <div *ngIf="sourceType === 'url'" class="source-section">
            <input
              type="url"
              class="url-input"
              placeholder="https://example.com/image.jpg"
              [(ngModel)]="imageUrl"
              (keyup.enter)="loadFromUrl()"
            />
            <button (click)="loadFromUrl()" class="aurora-btn aurora-btn-primary aurora-btn-md aurora-btn-w-full">
              üîó –ó–∞–≥—Ä—É–∑–∏—Ç—å
            </button>
            <p class="source-hint">–í–≤–µ–¥–∏—Ç–µ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</p>
          </div>

          <!-- Drag & Drop Zone -->
          <div *ngIf="sourceType === 'drop'" class="source-section">
            <div
              class="drop-zone"
              [class.drag-over]="isDragOver"
              (drop)="onDrop($event)"
              (dragover)="onDragOver($event)"
              (dragleave)="onDragLeave($event)"
            >
              <span class="drop-icon">üì•</span>
              <p class="drop-text">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Å—é–¥–∞</p>
              <small class="drop-hint">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã</small>
            </div>
          </div>
        </div>

        <!-- Error Message -->
        <div class="error-message" *ngIf="errorMessage">
          <span class="error-icon">‚ö†Ô∏è</span>
          <span class="error-text">{{ errorMessage }}</span>
        </div>
      </ng-container>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CROP TAB ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <ng-container *ngIf="activeTab === 'crop'">
        <!-- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
        <div class="crop-controls-fixed">
          <div class="crop-controls-row">
            <!-- –ß–µ–∫–±–æ–∫—Å—ã -->
            <label class="checkbox-label">
              <input type="checkbox" [(ngModel)]="cropConfig.proportional" (change)="onProportionalChange()" checked />
              <span>–ü—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ</span>
            </label>
            <label class="checkbox-label">
              <input type="checkbox" [(ngModel)]="cropConfig.showGrid" (change)="onGridChange()" checked />
              <span>–ü–æ–∫–∞–∑–∞—Ç—å —Å–µ—Ç–∫—É</span>
            </label>
            <label class="checkbox-label">
              <input type="checkbox" [(ngModel)]="cropConfig.hardSizeEnabled" (change)="onHardSizeChange()" checked />
              <span>–°–≤–æ–π —Ä–∞–∑–º–µ—Ä</span>
            </label>

            <!-- –ö–Ω–æ–ø–∫–∞ –æ–±—Ä–µ–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∞ -->
            <button class="aurora-btn aurora-btn-primary aurora-btn-md crop-btn-right" (click)="applyCrop()">
              ‚úÇÔ∏è –û–±—Ä–µ–∑–∞—Ç—å
            </button>
          </div>
        </div>

        <!-- –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <div class="crop-scrollable-content">
          <!-- –°–≤–æ–π —Ä–∞–∑–º–µ—Ä -->
          <div class="hard-size-section-compact" *ngIf="cropConfig.hardSizeEnabled">
            <h4>–°–≤–æ–π —Ä–∞–∑–º–µ—Ä (px)</h4>
            <div class="size-input-row-tall">
              <input
                type="number"
                placeholder="–®–∏—Ä–∏–Ω–∞"
                [(ngModel)]="cropConfig.targetWidth"
                (input)="onTargetSizeChange('width')"
                min="1"
              />
              <button
                class="aurora-btn aurora-btn-ghost aurora-btn-xs aurora-btn-icon"
                [class.aurora-btn-active]="cropConfig.proportionLocked"
                (click)="toggleProportionLock()"
                title="{{ cropConfig.proportionLocked ? '–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏' : '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏' }}"
              >
                {{ cropConfig.proportionLocked ? 'üîí' : 'üîì' }}
              </button>
              <input
                type="number"
                placeholder="–í—ã—Å–æ—Ç–∞"
                [(ngModel)]="cropConfig.targetHeight"
                (input)="onTargetSizeChange('height')"
                min="1"
              />
              <button
                class="aurora-btn aurora-btn-primary aurora-btn-sm"
                (click)="applyTargetSize()"
                title="–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ä–∞–∑–º–µ—Ä –∫ —Ä–∞–º–∫–µ –æ–±—Ä–µ–∑–∫–∏"
              >
                –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–∞–º–∫—É
              </button>
            </div>
          </div>

          <!-- –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å -->
          <hr class="crop-section-divider" *ngIf="cropConfig.hardSizeEnabled" />

          <!-- –ë–ª–æ–∫ —É–≤–µ–ª–∏—á–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (Upscaling) -->
          <div
            class="hard-size-section-compact resize-block-bg"
            style="background: #fff1f2; border: 1px dashed #fda4af; padding: 12px; border-radius: 8px; margin-top: 15px"
          >
            <h4
              style="
                color: #9f1239;
                margin-bottom: 10px;
                display: flex;
                align-items: center;
                gap: 8px;
                font-weight: 600;
              "
            >
              üöÄ –£–≤–µ–ª–∏—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
              <span
                style="
                  background: #f43f5e;
                  color: white;
                  font-size: 10px;
                  padding: 2px 6px;
                  border-radius: 4px;
                  font-weight: 500;
                "
                >Beta</span
              >
            </h4>
            <div class="size-input-row-tall">
              <input
                type="number"
                placeholder="–®–∏—Ä–∏–Ω–∞"
                [(ngModel)]="resizeWidth"
                (input)="onResizeSizeChange('width')"
                min="1"
              />
              <button
                class="aurora-btn aurora-btn-ghost aurora-btn-xs aurora-btn-icon"
                [class.aurora-btn-active]="resizeProportionLocked"
                (click)="toggleResizeProportionLock()"
                title="{{ resizeProportionLocked ? '–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏' : '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏' }}"
              >
                {{ resizeProportionLocked ? 'üîí' : 'üîì' }}
              </button>
              <input
                type="number"
                placeholder="–í—ã—Å–æ—Ç–∞"
                [(ngModel)]="resizeHeight"
                (input)="onResizeSizeChange('height')"
                min="1"
              />
              <button
                class="aurora-btn aurora-btn-primary aurora-btn-sm"
                (click)="resizeImageExplicitly()"
                style="white-space: nowrap"
              >
                –£–≤–µ–ª–∏—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
              </button>
            </div>
            <div style="margin-top: 10px">
              <label
                class="checkbox-label"
                style="font-size: 13px; color: #9f1239; cursor: pointer; display: flex; align-items: center; gap: 6px"
              >
                <input type="checkbox" [(ngModel)]="resizeProportionLocked" />
                <span>–ü—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ</span>
              </label>
            </div>
            <p style="color: #e11d48; margin-top: 8px; font-size: 11px; margin-bottom: 0">
              ‚ö†Ô∏è –û—Å—Ç–æ—Ä–æ–∂–Ω–æ: —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –º–æ–∂–µ—Ç —Å–Ω–∏–∑–∏—Ç—å —á–µ—Ç–∫–æ—Å—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.
            </p>
          </div>

          <!-- –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –º–µ–∂–¥—É "–£–≤–µ–ª–∏—á–∏—Ç—å" –∏ "–ü—Ä–µ—Å–µ—Ç—ã" -->
          <hr class="crop-section-divider" />

          <!-- –ü—Ä–µ—Å–µ—Ç—ã -->
          <app-crop-presets [(selectedPreset)]="selectedPreset" (presetSelected)="onPresetSelected($event)">
          </app-crop-presets>
        </div>
      </ng-container>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CIRCLE TAB ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <ng-container *ngIf="activeTab === 'circle'">
        <!-- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –∫—Ä—É–≥–æ–≤–æ–π –æ–±—Ä–µ–∑–∫–∏ -->
        <div class="circle-controls-fixed">
          <div class="circle-controls-row">
            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫—Ä—É–≥–µ -->
            <div class="circle-info" *ngIf="circleConfig.radius > 0">
              <span>R: {{ circleConfig.radius }}px</span>
              <span>‚åÄ {{ circleConfig.radius * 2 }}px</span>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
            <div class="circle-actions">
              <button
                class="aurora-btn aurora-btn-ghost aurora-btn-sm"
                (click)="centerCircle()"
                title="–¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∫—Ä—É–≥ (Ctrl+C)"
              >
                ‚äô –¶–µ–Ω—Ç—Ä
              </button>
              <button
                class="aurora-btn aurora-btn-ghost aurora-btn-sm"
                (click)="resetCircleToOptimal()"
                title="–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä (Ctrl+R)"
              >
                ‚Üª –°–±—Ä–æ—Å
              </button>
              <button
                class="aurora-btn aurora-btn-primary aurora-btn-md circle-btn-right"
                (click)="applyCircle()"
                title="–ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫—Ä—É–≥–æ–≤—É—é –æ–±—Ä–µ–∑–∫—É (Enter)"
              >
                ‚≠ï –û–±—Ä–µ–∑–∞—Ç—å –≤ –∫—Ä—É–≥
              </button>
            </div>
          </div>
        </div>

        <!-- –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∫—Ä—É–≥–∞ -->
        <div class="circle-scrollable-content">
          <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ -->
          <section class="control-block">
            <h4>üé® –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</h4>
            <div class="circle-settings-grid">
              <!-- –¶–≤–µ—Ç –æ–±–≤–æ–¥–∫–∏ -->
              <div class="color-picker-wrapper">
                <label>–¶–≤–µ—Ç –æ–±–≤–æ–¥–∫–∏:</label>
                <input
                  type="color"
                  [(ngModel)]="circleConfig.strokeColor"
                  (change)="updateCircleOverlay()"
                  class="color-input"
                />
              </div>

              <!-- –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –∑–∞—Ç–µ–º–Ω–µ–Ω–∏—è -->
              <div class="slider-wrapper">
                <label>–ó–∞—Ç–µ–º–Ω–µ–Ω–∏–µ: {{ Math.round(circleConfig.fillOpacity * 100) }}%</label>
                <input
                  type="range"
                  min="0"
                  max="1"
                  step="0.1"
                  [(ngModel)]="circleConfig.fillOpacity"
                  (input)="updateCircleOverlay()"
                  class="slider"
                />
              </div>
            </div>
          </section>
          <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
          <section class="control-block" *ngIf="circleConfig.radius > 0">
            <h4>üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h4>
            <div class="info-grid">
              <div class="info-item">
                <span class="info-label">–¶–µ–Ω—Ç—Ä:</span>
                <span class="info-value">{{ circleConfig.centerX }}, {{ circleConfig.centerY }}</span>
              </div>
              <div class="info-item">
                <span class="info-label">–†–∞–¥–∏—É—Å:</span>
                <span class="info-value">{{ circleConfig.radius }}px</span>
              </div>
              <div class="info-item">
                <span class="info-label">–î–∏–∞–º–µ—Ç—Ä:</span>
                <span class="info-value">{{ circleConfig.radius * 2 }}px</span>
              </div>
              <div class="info-item">
                <span class="info-label">–ü–ª–æ—â–∞–¥—å:</span>
                <span class="info-value">{{ Math.round(Math.PI * circleConfig.radius * circleConfig.radius) }}px¬≤</span>
              </div>
            </div>
          </section>

          <!-- –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏ -->
          <section class="control-block">
            <h4>‚å®Ô∏è –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏</h4>
            <div class="shortcuts-list">
              <div class="shortcut-item">
                <kbd>Enter</kbd>
                <span>–ü—Ä–∏–º–µ–Ω–∏—Ç—å –æ–±—Ä–µ–∑–∫—É</span>
              </div>
              <div class="shortcut-item">
                <kbd>Escape</kbd>
                <span>–û—Ç–º–µ–Ω–∏—Ç—å</span>
              </div>
              <div class="shortcut-item">
                <kbd>Ctrl+C</kbd>
                <span>–¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∫—Ä—É–≥</span>
              </div>
              <div class="shortcut-item">
                <kbd>Ctrl+R</kbd>
                <span>–°–±—Ä–æ—Å–∏—Ç—å —Ä–∞–∑–º–µ—Ä</span>
              </div>
            </div>
          </section>
        </div>
      </ng-container>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FRAME TAB ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <ng-container *ngIf="activeTab === 'frame'">
        <!-- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è —Ä–∞–º–æ–∫ -->
        <div class="frame-controls-fixed">
          <div class="frame-controls-row">
            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–º–∫–µ –∏ —Ä–∞–∑–º–µ—Ä–µ -->
            <div class="frame-info" *ngIf="frameConfig.thickness > 0">
              <span>{{ frameConfig.thickness }}px {{ frameConfig.type }}</span>
              <span class="frame-size-info" [class.size-changed]="getFramedImageSize().mode === 'around'">
                üìê {{ getFramedImageSize().width }}√ó{{ getFramedImageSize().height }}px
                <small>({{ getFramedImageSize().sizeChange }})</small>
              </span>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
            <div class="frame-actions">
              <button
                class="aurora-btn aurora-btn-ghost aurora-btn-sm"
                (click)="resetFrameConfig()"
                title="–°–±—Ä–æ—Å–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (Ctrl+R)"
              >
                ‚Üª –°–±—Ä–æ—Å
              </button>
              <button
                class="aurora-btn aurora-btn-primary aurora-btn-md frame-btn-right"
                (click)="applyFrame()"
                title="–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ä–∞–º–∫—É (Enter)"
              >
                üñºÔ∏è –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ä–∞–º–∫—É
              </button>
            </div>
          </div>
        </div>

        <!-- –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ —Ä–∞–º–æ–∫ -->
        <div class="frame-scrollable-content">
          <!-- –ë—ã—Å—Ç—Ä—ã–µ —Å—Ç–∏–ª–∏ —Ä–∞–º–æ–∫ -->
          <section class="control-block">
            <h4>‚ú® –ë—ã—Å—Ç—Ä—ã–µ —Å—Ç–∏–ª–∏</h4>
            <div class="frame-presets-grid">
              <div
                class="frame-preset-item"
                *ngFor="let preset of framePresets"
                [class.active]="selectedFramePreset === preset.id"
                (click)="selectFramePreset(preset.id)"
                [title]="preset.description"
              >
                <div class="preset-preview" [innerHTML]="preset.preview"></div>
                <span class="preset-name">{{ preset.name }}</span>
              </div>
            </div>
          </section>

          <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞–º–∫–∏ -->
          <section class="control-block">
            <h4>üé® –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞–º–∫–∏</h4>
            <div class="frame-settings-grid">
              <!-- –¢–∏–ø —Ä–∞–º–∫–∏ -->
              <div class="select-wrapper">
                <label>–¢–∏–ø:</label>
                <select [(ngModel)]="frameConfig.type" (change)="updateFramePreview()" class="frame-select">
                  <option value="solid">–°–ø–ª–æ—à–Ω–∞—è</option>
                  <option value="dashed">–ü—É–Ω–∫—Ç–∏—Ä–Ω–∞—è</option>
                  <option value="dotted">–¢–æ—á–µ—á–Ω–∞—è</option>
                  <option value="double">–î–≤–æ–π–Ω–∞—è</option>
                  <option value="groove">–í–¥–∞–≤–ª–µ–Ω–Ω–∞—è</option>
                  <option value="ridge">–í—ã–ø—É–∫–ª–∞—è</option>
                  <option value="shadow">–¢–µ–Ω—å</option>
                  <option value="gradient">–ì—Ä–∞–¥–∏–µ–Ω—Ç</option>
                  <option value="rounded">–°–∫—Ä—É–≥–ª–µ–Ω–Ω–∞—è</option>
                </select>
              </div>

              <!-- –¢–æ–ª—â–∏–Ω–∞ -->
              <div class="slider-wrapper">
                <label>–¢–æ–ª—â–∏–Ω–∞: {{ frameConfig.thickness }}px</label>
                <input
                  type="range"
                  min="1"
                  max="50"
                  step="1"
                  [(ngModel)]="frameConfig.thickness"
                  (input)="updateFramePreview()"
                  class="slider"
                />
              </div>

              <!-- –¶–≤–µ—Ç —Ä–∞–º–∫–∏ -->
              <div class="color-picker-wrapper">
                <label>–¶–≤–µ—Ç:</label>
                <input
                  type="color"
                  [(ngModel)]="frameConfig.color"
                  (change)="updateFramePreview()"
                  class="color-input"
                />
              </div>

              <!-- –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å -->
              <div class="slider-wrapper">
                <label>–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å: {{ Math.round(frameConfig.opacity * 100) }}%</label>
                <input
                  type="range"
                  min="0"
                  max="1"
                  step="0.1"
                  [(ngModel)]="frameConfig.opacity"
                  (input)="updateFramePreview()"
                  class="slider"
                />
              </div>

              <!-- –û—Ç—Å—Ç—É–ø -->
              <div class="slider-wrapper">
                <label>–û—Ç—Å—Ç—É–ø: {{ frameConfig.padding }}px</label>
                <input
                  type="range"
                  min="0"
                  max="20"
                  step="1"
                  [(ngModel)]="frameConfig.padding"
                  (input)="updateFramePreview()"
                  class="slider"
                />
              </div>

              <!-- –°–∫—Ä—É–≥–ª–µ–Ω–∏–µ —É–≥–ª–æ–≤ -->
              <div class="slider-wrapper">
                <label>–°–∫—Ä—É–≥–ª–µ–Ω–∏–µ: {{ frameConfig.borderRadius }}px</label>
                <input
                  type="range"
                  min="0"
                  max="25"
                  step="1"
                  [(ngModel)]="frameConfig.borderRadius"
                  (input)="updateFramePreview()"
                  class="slider"
                />
              </div>
            </div>
          </section>

          <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -->
          <section class="control-block" *ngIf="frameConfig.type === 'shadow' || frameConfig.type === 'gradient'">
            <h4>‚öôÔ∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h4>

            <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ–Ω–∏ -->
            <div class="frame-settings-grid" *ngIf="frameConfig.type === 'shadow'">
              <div class="slider-wrapper">
                <label>–†–∞–∑–º—ã—Ç–∏–µ —Ç–µ–Ω–∏: {{ frameConfig.shadow?.blur || 0 }}px</label>
                <input
                  type="range"
                  min="0"
                  max="50"
                  step="1"
                  [ngModel]="frameConfig.shadow?.blur || 0"
                  (input)="updateShadowBlur($event); updateFramePreview()"
                  class="slider"
                />
              </div>

              <div class="color-picker-wrapper">
                <label>–¶–≤–µ—Ç —Ç–µ–Ω–∏:</label>
                <input
                  type="color"
                  [ngModel]="frameConfig.shadow?.color || '#000000'"
                  (change)="updateShadowColor($event); updateFramePreview()"
                  class="color-input"
                />
              </div>
            </div>

            <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ -->
            <div class="frame-settings-grid" *ngIf="frameConfig.type === 'gradient'">
              <div class="select-wrapper">
                <label>–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:</label>
                <select
                  [ngModel]="frameConfig.gradient?.direction || 'to-right'"
                  (change)="updateGradientDirection($event); updateFramePreview()"
                  class="frame-select"
                >
                  <option value="to-right">–°–ª–µ–≤–∞ –Ω–∞–ø—Ä–∞–≤–æ</option>
                  <option value="to-left">–°–ø—Ä–∞–≤–∞ –Ω–∞–ª–µ–≤–æ</option>
                  <option value="to-bottom">–°–≤–µ—Ä—Ö—É –≤–Ω–∏–∑</option>
                  <option value="to-top">–°–Ω–∏–∑—É –≤–≤–µ—Ä—Ö</option>
                  <option value="to-bottom-right">–î–∏–∞–≥–æ–Ω–∞–ª—å ‚Üò</option>
                  <option value="to-bottom-left">–î–∏–∞–≥–æ–Ω–∞–ª—å ‚Üô</option>
                  <option value="radial">–†–∞–¥–∏–∞–ª—å–Ω—ã–π</option>
                </select>
              </div>
            </div>
          </section>

          <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–º–∫–µ -->
          <section class="control-block" *ngIf="frameConfig.thickness > 0">
            <h4>üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h4>
            <div class="info-grid">
              <div class="info-item">
                <span class="info-label">–¢–∏–ø:</span>
                <span class="info-value">{{ getFrameTypeLabel(frameConfig.type) }}</span>
              </div>
              <div class="info-item">
                <span class="info-label">–¢–æ–ª—â–∏–Ω–∞:</span>
                <span class="info-value">{{ frameConfig.thickness }}px</span>
              </div>
              <div class="info-item">
                <span class="info-label">–û—Ç—Å—Ç—É–ø:</span>
                <span class="info-value">{{ frameConfig.padding }}px</span>
              </div>
              <div class="info-item">
                <span class="info-label">–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å:</span>
                <span class="info-value">{{ Math.round(frameConfig.opacity * 100) }}%</span>
              </div>
            </div>
          </section>

          <!-- –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏ -->
          <section class="control-block">
            <h4>‚å®Ô∏è –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏</h4>
            <ul class="hotkeys-list">
              <li><kbd>Enter</kbd> ‚Äî –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ä–∞–º–∫—É</li>
              <li><kbd>Escape</kbd> ‚Äî –û—Ç–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</li>
              <li><kbd>Ctrl+R</kbd> ‚Äî –°–±—Ä–æ—Å–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</li>
            </ul>
          </section>
        </div>
      </ng-container>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê EDIT TAB ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <ng-container *ngIf="activeTab === 'edit'">
        <!-- –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <section class="control-block">
          <h3 class="control-title">üîÑ –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
          <div class="control-buttons-row">
            <button class="aurora-btn aurora-btn-ghost aurora-btn-sm" (click)="applyRotation(90)">‚Üª 90¬∞</button>
            <button class="aurora-btn aurora-btn-ghost aurora-btn-sm" (click)="applyRotation(180)">‚Üª 180¬∞</button>
            <button class="aurora-btn aurora-btn-ghost aurora-btn-sm" (click)="applyRotation(270)">‚Üª 270¬∞</button>
            <button class="aurora-btn aurora-btn-ghost aurora-btn-sm" (click)="applyFlip('horizontal')">‚áÑ H</button>
            <button class="aurora-btn aurora-btn-ghost aurora-btn-sm" (click)="applyFlip('vertical')">‚áÖ V</button>
          </div>
        </section>

        <!-- –§–∏–ª—å—Ç—Ä—ã -->
        <section class="control-block">
          <h3 class="control-title">üé® –§–∏–ª—å—Ç—Ä—ã</h3>
          <!-- –ü–µ—Ä–≤—ã–π —Ä—è–¥: –Ø—Ä–∫–æ—Å—Ç—å, –ö–æ–Ω—Ç—Ä–∞—Å—Ç, –ù–∞—Å—ã—â–µ–Ω–Ω–æ—Å—Ç—å -->
          <div class="sliders-row">
            <div class="slider-group">
              <label
                >–Ø—Ä–∫–æ—Å—Ç—å <span>{{ brightness }}</span></label
              >
              <input type="range" [(ngModel)]="brightness" min="-100" max="100" />
            </div>
            <div class="slider-group">
              <label
                >–ö–æ–Ω—Ç—Ä–∞—Å—Ç <span>{{ contrast }}</span></label
              >
              <input type="range" [(ngModel)]="contrast" min="-100" max="100" />
            </div>
            <div class="slider-group">
              <label
                >–ù–∞—Å—ã—â–µ–Ω–Ω–æ—Å—Ç—å <span>{{ saturation }}</span></label
              >
              <input type="range" [(ngModel)]="saturation" min="-100" max="100" />
            </div>
          </div>
          <!-- –í—Ç–æ—Ä–æ–π —Ä—è–¥: –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã -->
          <div class="sliders-row">
            <div class="slider-group">
              <label
                >–û—Ç—Ç–µ–Ω–æ–∫ <span>{{ hueRotate }}¬∞</span></label
              >
              <input type="range" [(ngModel)]="hueRotate" min="0" max="360" />
            </div>
            <div class="slider-group">
              <label
                >–†–∞–∑–º—ã—Ç–∏–µ <span>{{ blur }}px</span></label
              >
              <input type="range" [(ngModel)]="blur" min="0" max="10" step="0.5" />
            </div>
            <div class="slider-group">
              <label
                >–ß/–ë <span>{{ grayscale }}%</span></label
              >
              <input type="range" [(ngModel)]="grayscale" min="0" max="100" />
            </div>
            <div class="slider-group">
              <label
                >–°–µ–ø–∏—è <span>{{ sepia }}%</span></label
              >
              <input type="range" [(ngModel)]="sepia" min="0" max="100" />
            </div>
            <div class="slider-group">
              <label
                >–ò–Ω–≤–µ—Ä—Å–∏—è <span>{{ invert }}%</span></label
              >
              <input type="range" [(ngModel)]="invert" min="0" max="100" />
            </div>
          </div>
          <div class="control-buttons-row">
            <button class="aurora-btn aurora-btn-secondary aurora-btn-sm" (click)="resetFilters()">‚Ü∫ –°–±—Ä–æ—Å–∏—Ç—å</button>
          </div>
        </section>

        <!-- –≠—Ñ—Ñ–µ–∫—Ç—ã -->
        <section class="control-block">
          <h3 class="control-title">üñºÔ∏è –≠—Ñ—Ñ–µ–∫—Ç—ã</h3>
          <div class="control-buttons-row">
            <button
              class="aurora-btn aurora-btn-ghost aurora-btn-md aurora-btn-icon"
              (click)="applyPresetFilter('grayscale')"
            >
              ‚ö´
            </button>
            <button
              class="aurora-btn aurora-btn-ghost aurora-btn-md aurora-btn-icon"
              (click)="applyPresetFilter('sepia')"
            >
              üü§
            </button>
            <button
              class="aurora-btn aurora-btn-ghost aurora-btn-md aurora-btn-icon"
              (click)="applyPresetFilter('vintage')"
            >
              üì∑
            </button>
            <button
              class="aurora-btn aurora-btn-ghost aurora-btn-md aurora-btn-icon"
              (click)="applyPresetFilter('cold')"
            >
              ‚ùÑÔ∏è
            </button>
            <button
              class="aurora-btn aurora-btn-ghost aurora-btn-md aurora-btn-icon"
              (click)="applyPresetFilter('warm')"
            >
              üî•
            </button>
          </div>
        </section>
      </ng-container>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê WATERMARK TAB (v2) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <ng-container *ngIf="activeTab === 'watermark'">
        <div class="watermark-controls">
          <!-- –í–∫–ª—é—á–µ–Ω–∏–µ –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞ -->
          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" [(ngModel)]="watermarkConfig.enabled" (change)="onWatermarkChange()" />
              <span>–í–∫–ª—é—á–∏—Ç—å –≤–æ–¥—è–Ω–æ–π –∑–Ω–∞–∫</span>
            </label>
          </div>

          <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å Text/Image (v2) -->
          <div class="form-group" *ngIf="watermarkConfig.enabled">
            <label>–¢–∏–ø –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞</label>
            <div class="type-toggle">
              <button [class.active]="watermarkConfig.type === 'text'" (click)="onTypeChange('text')" type="button">
                üìù –¢–µ–∫—Å—Ç
              </button>
              <button [class.active]="watermarkConfig.type === 'image'" (click)="onTypeChange('image')" type="button">
                üñºÔ∏è –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
              </button>
            </div>
          </div>

          <!-- ‚ïê‚ïê‚ïê –¢–ï–ö–°–¢–û–í–´–ô –í–û–î–Ø–ù–û–ô –ó–ù–ê–ö ‚ïê‚ïê‚ïê -->
          <ng-container *ngIf="watermarkConfig.enabled && watermarkConfig.type === 'text'">
            <!-- –¢–µ–∫—Å—Ç –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞ -->
            <div class="form-group">
              <label for="watermark-text">–¢–µ–∫—Å—Ç –≤–æ–¥—è–Ω–æ–≥–æ –∑–Ω–∞–∫–∞</label>
              <input
                type="text"
                id="watermark-text"
                [(ngModel)]="watermarkConfig.text"
                (ngModelChange)="onWatermarkChange()"
                placeholder="¬© 2025 –í–∞—à–∞ –∫–æ–º–ø–∞–Ω–∏—è"
                maxlength="100"
              />
            </div>

            <!-- –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ (v2) -->
            <div class="form-group">
              <label for="font-size">
                –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞:
                <span class="slider-value">{{ watermarkConfig.fontSize || '–ê–≤—Ç–æ' }}px</span>
              </label>
              <input
                type="range"
                id="font-size"
                min="12"
                max="72"
                step="1"
                [(ngModel)]="watermarkConfig.fontSize"
                (ngModelChange)="onFontSizeChange($event)"
              />
            </div>

            <!-- –°–µ–º–µ–π—Å—Ç–≤–æ —à—Ä–∏—Ñ—Ç–∞ (v2) -->
            <div class="form-group">
              <label for="font-family">–®—Ä–∏—Ñ—Ç</label>
              <select
                id="font-family"
                [(ngModel)]="watermarkConfig.fontFamily"
                (change)="onFontFamilyChange(watermarkConfig.fontFamily)"
              >
                <option *ngFor="let font of availableFonts" [value]="font.value">
                  {{ font.label }}
                </option>
              </select>
            </div>

            <!-- –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ (v2) -->
            <div class="form-group">
              <label for="text-color">–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞</label>
              <div class="color-picker-wrapper">
                <input
                  type="color"
                  id="text-color"
                  [(ngModel)]="watermarkConfig.color"
                  (change)="onColorChange(watermarkConfig.color)"
                />
                <span class="color-value">{{ watermarkConfig.color }}</span>
              </div>
            </div>
          </ng-container>

          <!-- ‚ïê‚ïê‚ïê –í–û–î–Ø–ù–û–ô –ó–ù–ê–ö - –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ï ‚ïê‚ïê‚ïê -->
          <ng-container *ngIf="watermarkConfig.enabled && watermarkConfig.type === 'image'">
            <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–≥–æ—Ç–∏–ø–∞ -->
            <div class="form-group">
              <label>–õ–æ–≥–æ—Ç–∏–ø</label>
              <div class="image-upload-zone">
                <input
                  type="file"
                  #logoFileInput
                  accept="image/png,image/jpeg,image/svg+xml"
                  (change)="onLogoFileChange($event)"
                  style="display: none"
                />
                <button type="button" (click)="logoFileInput.click()">üìÇ –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª</button>
                <span class="upload-hint">PNG, JPEG, SVG</span>
              </div>

              <!-- –ü—Ä–µ–≤—å—é –ª–æ–≥–æ—Ç–∏–ø–∞ -->
              <div class="image-preview-box" *ngIf="logoPreviewUrl">
                <img [src]="logoPreviewUrl" alt="–õ–æ–≥–æ—Ç–∏–ø" />
                <button type="button" class="remove-btn" (click)="removeLogo()" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</button>
              </div>
            </div>

            <!-- –†–∞–∑–º–µ—Ä—ã –ª–æ–≥–æ—Ç–∏–ø–∞ (v2) -->
            <div class="form-group" *ngIf="logoPreviewUrl">
              <label>
                –†–∞–∑–º–µ—Ä:
                <span class="slider-value"> {{ watermarkConfig.imageWidth }}x{{ watermarkConfig.imageHeight }}px </span>
              </label>
              <div class="size-controls">
                <div class="size-control">
                  <label>–®–∏—Ä–∏–Ω–∞</label>
                  <input
                    type="range"
                    min="50"
                    max="500"
                    step="10"
                    [(ngModel)]="watermarkConfig.imageWidth"
                    (ngModelChange)="onWatermarkChange()"
                  />
                </div>
                <div class="size-control">
                  <label>–í—ã—Å–æ—Ç–∞</label>
                  <input
                    type="range"
                    min="50"
                    max="500"
                    step="10"
                    [(ngModel)]="watermarkConfig.imageHeight"
                    (ngModelChange)="onWatermarkChange()"
                  />
                </div>
              </div>
            </div>
          </ng-container>

          <!-- ‚ïê‚ïê‚ïê –û–ë–©–ò–ï –ù–ê–°–¢–†–û–ô–ö–ò (–¥–ª—è –æ–±–æ–∏—Ö —Ç–∏–ø–æ–≤) ‚ïê‚ïê‚ïê -->
          <ng-container *ngIf="watermarkConfig.enabled && (watermarkConfig.text || logoPreviewUrl)">
            <!-- –ü–æ–∑–∏—Ü–∏—è (—Å–µ—Ç–∫–∞ 3x3) -->
            <div class="position-grid">
              <button
                class="position-btn"
                [class.active]="watermarkConfig.position === 'top-left'"
                (click)="setWatermarkPosition('top-left')"
                title="–í–µ—Ä—Ö–Ω–∏–π –ª–µ–≤—ã–π —É–≥–æ–ª"
              >
                ‚Üñ
              </button>
              <button
                class="position-btn"
                [class.active]="watermarkConfig.position === 'top-center'"
                (click)="setWatermarkPosition('top-center')"
                title="–í–µ—Ä—Ö–Ω–∏–π —Ü–µ–Ω—Ç—Ä"
              >
                ‚Üë
              </button>
              <button
                class="position-btn"
                [class.active]="watermarkConfig.position === 'top-right'"
                (click)="setWatermarkPosition('top-right')"
                title="–í–µ—Ä—Ö–Ω–∏–π –ø—Ä–∞–≤—ã–π —É–≥–æ–ª"
              >
                ‚Üó
              </button>
              <button
                class="position-btn"
                [class.active]="watermarkConfig.position === 'center-left'"
                (click)="setWatermarkPosition('center-left')"
                title="–¶–µ–Ω—Ç—Ä —Å–ª–µ–≤–∞"
              >
                ‚Üê
              </button>
              <button
                class="position-btn"
                [class.active]="watermarkConfig.position === 'center'"
                (click)="setWatermarkPosition('center')"
                title="–ü–æ —Ü–µ–Ω—Ç—Ä—É"
              >
                ‚óè
              </button>
              <button
                class="position-btn"
                [class.active]="watermarkConfig.position === 'center-right'"
                (click)="setWatermarkPosition('center-right')"
                title="–¶–µ–Ω—Ç—Ä —Å–ø—Ä–∞–≤–∞"
              >
                ‚Üí
              </button>
              <button
                class="position-btn"
                [class.active]="watermarkConfig.position === 'bottom-left'"
                (click)="setWatermarkPosition('bottom-left')"
                title="–ù–∏–∂–Ω–∏–π –ª–µ–≤—ã–π —É–≥–æ–ª"
              >
                ‚Üô
              </button>
              <button
                class="position-btn"
                [class.active]="watermarkConfig.position === 'bottom-center'"
                (click)="setWatermarkPosition('bottom-center')"
                title="–ù–∏–∂–Ω–∏–π —Ü–µ–Ω—Ç—Ä"
              >
                ‚Üì
              </button>
              <button
                class="position-btn"
                [class.active]="watermarkConfig.position === 'bottom-right'"
                (click)="setWatermarkPosition('bottom-right')"
                title="–ù–∏–∂–Ω–∏–π –ø—Ä–∞–≤—ã–π —É–≥–æ–ª"
              >
                ‚Üò
              </button>
            </div>

            <!-- –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å (v2) -->
            <div class="form-group">
              <label for="opacity">
                –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å:
                <span class="slider-value">{{ watermarkConfig.opacity }}%</span>
              </label>
              <input
                type="range"
                id="opacity"
                min="0"
                max="100"
                step="1"
                [(ngModel)]="watermarkConfig.opacity"
                (ngModelChange)="onOpacityChange($event)"
              />
            </div>

            <!-- –ü–æ–≤–æ—Ä–æ—Ç (v2) -->
            <div class="form-group">
              <label for="rotation">
                –ü–æ–≤–æ—Ä–æ—Ç:
                <span class="slider-value">{{ watermarkConfig.rotation }}¬∞</span>
              </label>
              <input
                type="range"
                id="rotation"
                min="-180"
                max="180"
                step="1"
                [(ngModel)]="watermarkConfig.rotation"
                (ngModelChange)="onRotationChange($event)"
              />
            </div>

            <!-- –°–º–µ—â–µ–Ω–∏–µ (v2) -->
            <div class="form-group">
              <label>–°–º–µ—â–µ–Ω–∏–µ</label>
              <div class="offset-controls">
                <div class="offset-control">
                  <label for="offset-x">
                    X:
                    <span class="slider-value">{{ watermarkConfig.offsetX }}px</span>
                  </label>
                  <input
                    type="range"
                    id="offset-x"
                    min="-500"
                    max="500"
                    step="5"
                    [(ngModel)]="watermarkConfig.offsetX"
                    (ngModelChange)="onOffsetChange('x', $event)"
                  />
                </div>
                <div class="offset-control">
                  <label for="offset-y">
                    Y:
                    <span class="slider-value">{{ watermarkConfig.offsetY }}px</span>
                  </label>
                  <input
                    type="range"
                    id="offset-y"
                    min="-500"
                    max="500"
                    step="5"
                    [(ngModel)]="watermarkConfig.offsetY"
                    (ngModelChange)="onOffsetChange('y', $event)"
                  />
                </div>
              </div>
            </div>
          </ng-container>

          <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
          <div class="control-buttons-row" *ngIf="watermarkConfig.enabled && (watermarkConfig.text || logoPreviewUrl)">
            <button class="aurora-btn aurora-btn-secondary aurora-btn-md" (click)="resetWatermark()">‚Ü∫ –°–±—Ä–æ—Å–∏—Ç—å</button>
            <button class="aurora-btn aurora-btn-primary aurora-btn-md" (click)="applyWatermark()">‚úì –ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
          </div>
        </div>
      </ng-container>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SETTINGS TAB ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <ng-container *ngIf="activeTab === 'settings'">
        <!-- Alt Text -->
        <div class="form-group form-group-inline">
          <label for="alt-text">Alt —Ç–µ–∫—Å—Ç</label>
          <input type="text" id="alt-text" [(ngModel)]="config.alt" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è" />
        </div>

        <!-- Caption -->
        <div class="form-group form-group-inline">
          <label for="caption">–ü–æ–¥–ø–∏—Å—å</label>
          <input type="text" id="caption" [(ngModel)]="config.caption" placeholder="–ü–æ–¥–ø–∏—Å—å –ø–æ–¥ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º" />
        </div>

        <!-- Title (–æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏) -->
        <div class="form-group form-group-inline">
          <label for="title-text">–û–ø–∏—Å–∞–Ω–∏–µ</label>
          <input
            type="text"
            id="title-text"
            [(ngModel)]="config.title"
            placeholder="–¢–µ–∫—Å—Ç –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ"
          />
        </div>

        <!-- Width -->
        <div class="form-group form-group-inline form-group-compact">
          <label>–®–∏—Ä–∏–Ω–∞</label>
          <div class="width-controls-row">
            <button
              class="aurora-btn aurora-btn-ghost aurora-btn-xs"
              [class.aurora-btn-active]="config.width === '100%'"
              (click)="config.width = '100%'"
            >
              100%
            </button>
            <button
              class="aurora-btn aurora-btn-ghost aurora-btn-xs"
              [class.aurora-btn-active]="config.width === '75%'"
              (click)="config.width = '75%'"
            >
              75%
            </button>
            <button
              class="aurora-btn aurora-btn-ghost aurora-btn-xs"
              [class.aurora-btn-active]="config.width === '50%'"
              (click)="config.width = '50%'"
            >
              50%
            </button>
            <button
              class="aurora-btn aurora-btn-ghost aurora-btn-xs"
              [class.aurora-btn-active]="config.width === 'auto'"
              (click)="config.width = 'auto'"
            >
              Auto
            </button>
            <input
              type="number"
              [(ngModel)]="customWidth"
              placeholder="px"
              min="100"
              max="2000"
              class="custom-width-input"
            />
            <button class="aurora-btn aurora-btn-primary aurora-btn-xs" (click)="config.width = customWidth + 'px'">
              –ü—Ä–∏–º–µ–Ω–∏—Ç—å
            </button>
          </div>
        </div>

        <!-- Alignment -->
        <div class="form-group form-group-compact">
          <label>–í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ</label>
          <div class="aurora-btn-group alignment-buttons">
            <button
              class="aurora-btn aurora-btn-ghost aurora-btn-xs"
              [class.aurora-btn-active]="config.alignment === 'left'"
              (click)="config.alignment = 'left'"
              title="–ü–æ –ª–µ–≤–æ–º—É –∫—Ä–∞—é"
            >
              ‚¨ÖÔ∏è
            </button>
            <button
              class="aurora-btn aurora-btn-ghost aurora-btn-xs"
              [class.aurora-btn-active]="config.alignment === 'center'"
              (click)="config.alignment = 'center'"
              title="–ü–æ —Ü–µ–Ω—Ç—Ä—É"
            >
              ‚ÜîÔ∏è
            </button>
            <button
              class="aurora-btn aurora-btn-ghost aurora-btn-xs"
              [class.aurora-btn-active]="config.alignment === 'right'"
              (click)="config.alignment = 'right'"
              title="–ü–æ –ø—Ä–∞–≤–æ–º—É –∫—Ä–∞—é"
            >
              ‚û°Ô∏è
            </button>
          </div>
        </div>

        <!-- Link URL -->
        <div class="form-group form-group-compact form-group-inline">
          <label for="link-url">–°—Å—ã–ª–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
          <input type="url" id="link-url" [(ngModel)]="config.linkUrl" placeholder="https://..." />
        </div>

        <!-- Clickable Checkbox -->
        <div class="form-group form-group-compact form-group-checkbox">
          <label class="checkbox-label">
            <input type="checkbox" [(ngModel)]="config.clickable" [disabled]="!config.linkUrl" />
            <span>–°–¥–µ–ª–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–º</span>
          </label>
          <small *ngIf="!config.linkUrl">–î–æ–±–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –≤—ã—à–µ, —á—Ç–æ–±—ã –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —ç—Ç—É –æ–ø—Ü–∏—é</small>
        </div>

        <!-- Open in New Window Checkbox -->
        <div class="form-group form-group-compact form-group-checkbox">
          <label class="checkbox-label">
            <input
              type="checkbox"
              [(ngModel)]="config.openInNewWindow"
              [disabled]="!config.linkUrl || !config.clickable"
            />
            <span>–û—Ç–∫—Ä—ã–≤–∞—Ç—å —Å—Å—ã–ª–∫—É –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ</span>
          </label>
          <small *ngIf="!config.clickable">–°–Ω–∞—á–∞–ª–∞ –∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –æ–ø—Ü–∏—é "–ö–ª–∏–∫–∞–±–µ–ª—å–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ"</small>
        </div>
      </ng-container>
    </div>

    <!-- DIV 3.3: Sidebar (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, 40px) -->
    <div class="body-sidebar" *ngIf="showSidebar">
      <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –ø–æ–∑–∂–µ -->
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- DIV 4: Status Bar -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="modal-status">
    <!-- Upload Progress -->
    <div class="status-message" *ngIf="uploadState.isUploading">
      <span class="status-icon status-spinner">‚è≥</span>
      <span class="status-text">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä...</span>
    </div>

    <!-- Upload Error -->
    <div class="status-message status-error" *ngIf="uploadState.uploadError && !uploadState.isUploading">
      <span class="status-icon">‚ùå</span>
      <span class="status-text">{{ uploadState.uploadError }}</span>
    </div>

    <!-- Normal Status -->
    <div class="status-message" *ngIf="!uploadState.isUploading && !uploadState.uploadError">
      <span class="status-icon">{{ statusIcon }}</span>
      <span class="status-text">{{ statusMessage }}</span>
    </div>
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- –°—Ç–∞—Ç—É—Å-–±–∞—Ä —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="status-info" *ngIf="previewUrl && statusBarInfo">
      <span class="status-bar-content">{{ statusBarInfo }}</span>
      <button
        class="aurora-btn aurora-btn-ghost aurora-btn-xs info-button"
        (click)="toggleImageInfoPopover()"
        title="–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"
        aria-label="–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏"
      >
        ‚ÑπÔ∏è
      </button>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!-- Popover —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="image-info-popover" *ngIf="showImageInfoPopover" @fadeInOut>
      <div class="popover-header">
        <h4>üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏</h4>
        <button class="close-btn" (click)="toggleImageInfoPopover()" aria-label="–ó–∞–∫—Ä—ã—Ç—å">√ó</button>
      </div>
      <div class="popover-content" *ngIf="imageData.metadata as meta">
        <div class="info-row">
          <span class="info-label">üìÅ –ò–º—è —Ñ–∞–π–ª–∞:</span>
          <span class="info-value">{{ meta.fileName }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">üñºÔ∏è –§–æ—Ä–º–∞—Ç:</span>
          <span class="info-value">
            {{ getFormatDisplayName(meta.format) }}
            <span
              *ngIf="meta.originalWidth && getImageFormatFromDataUrl(imageData.original!) !== meta.format"
              class="format-converted"
            >
              (–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –∏–∑ {{ getFormatDisplayName(getImageFormatFromDataUrl(imageData.original!)) }})
            </span>
          </span>
        </div>

        <div class="info-divider"></div>

        <div class="info-row">
          <span class="info-label">üìè –¢–µ–∫—É—â–∏–π —Ä–∞–∑–º–µ—Ä:</span>
          <span class="info-value">{{ meta.width }} √ó {{ meta.height }} px</span>
        </div>
        <div class="info-row" *ngIf="meta.originalWidth && meta.originalHeight">
          <span class="info-label">üìê –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π:</span>
          <span class="info-value">{{ meta.originalWidth }} √ó {{ meta.originalHeight }} px</span>
        </div>
        <div class="info-row" *ngIf="meta.originalWidth && meta.originalHeight">
          <span class="info-label">üìä –ò–∑–º–µ–Ω–µ–Ω–∏–µ:</span>
          <span class="info-value">{{ getImageSizeChangePercent(meta) }}%</span>
        </div>

        <div class="info-divider"></div>

        <div class="info-row">
          <span class="info-label">üíæ –¢–µ–∫—É—â–∏–π –≤–µ—Å:</span>
          <span class="info-value">{{ formatFileSize(meta.fileSize) }}</span>
        </div>
        <div class="info-row" *ngIf="meta.originalFileSize">
          <span class="info-label">üíæ –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π:</span>
          <span class="info-value">{{ formatFileSize(meta.originalFileSize) }}</span>
        </div>
        <div class="info-row" *ngIf="meta.originalFileSize">
          <span class="info-label">üìä –£–º–µ–Ω—å—à–µ–Ω–∏–µ:</span>
          <span class="info-value">{{ getFileSizeChangePercent(meta) }}%</span>
        </div>

        <div class="info-divider"></div>

        <div class="info-row">
          <span class="info-label">üîó –ò—Å—Ç–æ—á–Ω–∏–∫:</span>
          <span class="info-value">{{ getSourceDisplayName(meta.source) }}</span>
        </div>
        <div class="info-row" *ngIf="meta.sourceUrl">
          <span class="info-label">üåê URL:</span>
          <span class="info-value info-url" [title]="meta.sourceUrl">{{ meta.sourceUrl }}</span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Export Image Modal -->
<app-export-image-modal #exportModal (exported)="handleExportComplete($event)" (closed)="onExportModalClosed()">
</app-export-image-modal>
