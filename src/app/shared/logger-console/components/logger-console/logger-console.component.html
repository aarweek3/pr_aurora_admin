<div class="logger-container" [class.light-theme]="!isDarkTheme()">
  <!-- Toolbox / Header -->
  <header class="logger-toolbar">
    <!-- Top Row: Tabs, Search and Actions -->
    <div class="toolbar-row top-row">
      <div class="toolbar-left">
        <!-- –í–∫–ª–∞–¥–∫–∏ -->
        <div class="tabs-nav">
          <button class="tab-btn" [class.active]="activeTab() === 'logs'" (click)="activeTab.set('logs')">
            üìã Logs
          </button>
          <button class="tab-btn" [class.active]="activeTab() === 'navigation'" (click)="activeTab.set('navigation')">
            üß≠ Navigation
          </button>
          <button class="tab-btn" [class.active]="activeTab() === 'storage'" (click)="activeTab.set('storage')">
            üì¶ Storage
          </button>
          <button class="tab-btn" [class.active]="activeTab() === 'terminal'" (click)="activeTab.set('terminal')">
            üíª Terminal
          </button>
        </div>

        @if (activeTab() === 'logs') {
        <div class="search-box">
          <span class="search-icon">üîç</span>
          <input
            type="text"
            placeholder="Filter messages or prefixes..."
            [ngModel]="searchQuery()"
            (ngModelChange)="searchQuery.set($event)"
          />
        </div>
        }
      </div>

      <div class="toolbar-right">
        <button class="action-btn theme-toggle" (click)="toggleHelp()" title="Show Help" [class.active]="showHelp()">
          ‚ùì
        </button>
        <button
          class="action-btn theme-toggle"
          (click)="toggleTheme()"
          [title]="isDarkTheme() ? 'Switch to Light Mode' : 'Switch to Dark Mode'"
        >
          {{ isDarkTheme() ? '‚òÄÔ∏è' : 'üåô' }}
        </button>
        <button class="action-btn" [class.copied]="isCopied()" (click)="copyAllLogs()" title="Copy all visible logs">
          {{ isCopied() ? '‚úÖ Copied' : 'üìã Copy All' }}
        </button>
        <button class="action-btn" (click)="export()" title="Download JSON">üì• Export</button>
        <button class="action-btn danger" (click)="clear()" title="Clear logs">üóëÔ∏è Clear</button>
      </div>
    </div>

    <!-- Bottom Row: Filters (Only for Logs tab) -->
    @if (activeTab() === 'logs') {
    <div class="toolbar-row bottom-row">
      <div class="level-filters">
        <button
          class="filter-btn state-filter"
          [class.active]="showState()"
          (click)="toggleState()"
          title="Toggle Signal changes"
        >
          <span class="level-name">STATE</span>
        </button>
        <button
          class="filter-btn action-filter"
          [class.active]="showActions()"
          (click)="toggleActions()"
          title="Toggle User Actions"
        >
          <span class="level-name">ACTION</span>
        </button>
        <button
          class="filter-btn http-filter"
          [class.active]="showHttp()"
          (click)="toggleHttp()"
          title="Toggle HTTP requests"
        >
          <span class="level-name">HTTP</span>
        </button>
        @for (level of levels; track level) {
        <button
          class="filter-btn"
          [class.active]="activeLevels()[level]"
          [ngClass]="'btn-' + level"
          (click)="toggleLevel(level)"
        >
          <span class="level-name">{{ level }}</span>
          <span class="level-count">{{ counters()[level] }}</span>
        </button>
        }
      </div>
    </div>
    }
  </header>

  <!-- Client Info Bar -->
  <div class="client-info-bar">
    @let info = loggerService.clientInfo();
    <div class="info-item" title="Screen / Viewport">
      <span class="info-icon">üñ•Ô∏è</span>
      <span class="info-label">{{ info.resolution }}</span>
      <span class="info-value">({{ info.viewport }})</span>
    </div>
    <div class="info-item" title="Device / OS">
      <span class="info-icon">üíª</span>
      <span class="info-label">{{ info.device }}</span>
      <span class="info-value">[{{ info.os }}]</span>
    </div>
    <div class="info-item" title="Browser">
      <span class="info-icon">üåê</span>
      <span class="info-label">{{ info.browser }}</span>
    </div>
    <div class="info-item" title="Theme">
      <span class="info-icon">{{ info.theme === 'Dark' ? 'üåô' : '‚òÄÔ∏è' }}</span>
      <span class="info-label">{{ info.theme }}</span>
    </div>
    <div class="info-item" title="Language">
      <span class="info-icon">üåç</span>
      <span class="info-label">{{ info.language }}</span>
    </div>
    <div class="info-item" title="Network Status">
      <span class="network-dot" [class.online]="info.isOnline"></span>
      <span class="info-label">{{ info.isOnline ? 'Online' : 'Offline' }}</span>
    </div>
    <div class="info-item" title="API Endpoint">
      <span class="info-icon">üîó</span>
      <span class="info-label">API:</span>
      <span class="info-value">{{ info.apiEndpoint }}</span>
    </div>
  </div>

  <!-- Logs Viewport -->
  <main class="logger-viewport" #scrollContainer (scroll)="onScroll($event)">
    <div class="logs-list">
      @for (log of filteredLogs(); track log.id) {
      <div class="log-entry" [ngClass]="['level-' + log.level, 'type-' + log.type]">
        <div class="log-main">
          @if (log.type === 'http' && log.httpDetails) {
          <!-- HTTP LOG LAYOUT -->
          <span class="http-method" [attr.data-method]="log.httpDetails.method">{{ log.httpDetails.method }}</span>
          <span class="http-status" [class.status-error]="log.httpDetails.statusCode >= 400">{{
            log.httpDetails.statusCode
          }}</span>
          <span class="log-message http-url" [title]="log.httpDetails.url">{{ getUrlPath(log.httpDetails.url) }}</span>
          <span class="http-duration">{{ log.httpDetails.duration }}ms</span>
          } @else if (log.type === 'interaction' && log.interactionDetails) {
          <!-- INTERACTION LOG LAYOUT -->
          <span class="interaction-icon">üñ±Ô∏è</span>
          <span class="log-prefix">{{ log.prefix }}</span>
          <span class="log-message">
            <span class="interaction-tag">{{ log.interactionDetails.element }}</span>
            <span class="interaction-text">{{ log.interactionDetails.text }}</span>
          </span>
          } @else if (log.type === 'state' && log.stateDetails) {
          <!-- STATE LOG LAYOUT -->
          <span class="state-icon">üîÑ</span>
          <span class="log-prefix">{{ log.prefix }}</span>
          <span class="log-message">
            <span class="state-name">{{ log.stateDetails.name }}</span>
            <span class="state-change">
              <span class="old-value">{{ log.stateDetails.oldValue | json }}</span>
              <span class="arrow">‚Üí</span>
              <span class="new-value">{{ log.stateDetails.newValue | json }}</span>
            </span>
          </span>
          } @else {
          <!-- STANDARD LOG LAYOUT -->
          <span class="log-prefix">{{ log.prefix }}</span>
          <span class="log-message">{{ log.message }}</span>
          } @if (log.type === 'http') {
          <button class="copy-entry-btn curl-btn" (click)="copyAsCurl(log)" title="Copy as cURL">cURL</button>
          }
          <button class="copy-entry-btn" (click)="copyMessage(log.message)" title="Copy message">üìã</button>

          <div class="log-time">
            <span class="time-base">{{ log.timestamp | date : 'HH:mm' }}</span>
            <span class="time-ms">{{ log.timestamp | date : ':ss.SSS' }}</span>
          </div>
        </div>

        <!-- JSON Viewer for detailed data (if present) -->
        @if (log.data && log.data.length > 0) {
        <div class="log-details">
          @for (item of log.data; track $index) {
          <app-logger-console-json-viewer [value]="item" [path]="''"></app-logger-console-json-viewer>
          }
        </div>
        }
      </div>
      } @empty {
      <div class="empty-state">No logs match your filter</div>
      }
    </div>
  </main>

  <!-- Footer Info -->
  <footer class="logger-footer">
    <div class="status-info">Total: {{ loggerService.logs().length }} | Showing: {{ filteredLogs().length }}</div>
    <div class="scroll-mode">Status: {{ autoScroll ? 'Sticky Bottom' : 'Manual Scroll' }}</div>
  </footer>

  <!-- Help Overlay -->
  @if (showHelp()) {
  <div class="help-overlay" (click)="toggleHelp()">
    <div class="help-content" (click)="$event.stopPropagation()">
      <div class="help-header">
        <h3>üöÄ –°–ø—Ä–∞–≤–∫–∞ Logger Console</h3>
        <button class="close-help" (click)="toggleHelp()">√ó</button>
      </div>

      <div class="help-grid">
        <section>
          <h4>üîÑ –ò—Å—Ç–æ—Ä–∏—è –°–∏–≥–Ω–∞–ª–æ–≤ (Signals)</h4>
          <p>–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π Angular Signals –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏. –í –∫–æ–¥–µ:</p>
          <code>this.loggerService.trackSignal(mySignal, '–ò–º—è–°–∏–≥–Ω–∞–ª–∞');</code>
          <p>–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥ –æ—Ç —Å—Ç–∞—Ä–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –∫ –Ω–æ–≤–æ–º—É. –§–∏–ª—å—Ç—Ä: –∫–Ω–æ–ø–∫–∞ <strong>STATE</strong>.</p>
        </section>

        <section>
          <h4>üñ±Ô∏è –î–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h4>
          <p>
            –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–ø–∏—Å—å –≤—Å–µ—Ö –∫–ª–∏–∫–æ–≤ –Ω–∞ –∫–Ω–æ–ø–∫–∏ –∏ —Å—Å—ã–ª–∫–∏. –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—É—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫ –æ—à–∏–±–∫–µ.
            –§–∏–ª—å—Ç—Ä: –∫–Ω–æ–ø–∫–∞ <strong>ACTION</strong>.
          </p>
        </section>

        <section>
          <h4>üîå –°–µ—Ç—å –∏ –û–∫—Ä—É–∂–µ–Ω–∏–µ</h4>
          <p>
            <strong>HTTP:</strong> –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö API-–∑–∞–ø—Ä–æ—Å–æ–≤, –∏—Ö —Å—Ç–∞—Ç—É—Å–æ–≤ –∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏. –§–∏–ª—å—Ç—Ä: –∫–Ω–æ–ø–∫–∞
            <strong>HTTP</strong>.
          </p>
          <p>
            <strong>–ò–Ω—Ñ–æ:</strong> –í –≤–µ—Ä—Ö–Ω–µ–π –ø–∞–Ω–µ–ª–∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞, —Ç–µ–º–∞ –∏ —Å—Ç–∞—Ç—É—Å —Å–µ—Ç–∏ (Online/Offline).
          </p>
        </section>

        <section>
          <h4>üì¶ –°–µ—Ä–≤–∏—Å –∏ –≠–∫—Å–ø–æ—Ä—Ç</h4>
          <ul>
            <li><strong>Export:</strong> –°–∫–∞—á–∞—Ç—å –ª–æ–≥–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞.</li>
            <li><strong>Clear:</strong> –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –±—É—Ñ–µ—Ä–∞ (–ª–∏–º–∏—Ç 1000 –∑–∞–ø–∏—Å–µ–π).</li>
          </ul>
        </section>

        <section>
          <h4>üóÑÔ∏è Storage Editor</h4>
          <p>
            –ü—Ä–æ—Å–º–æ—Ç—Ä –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ <strong>LocalStorage</strong>, <strong>SessionStorage</strong> –∏
            <strong>Cookies</strong> –ø—Ä—è–º–æ –≤ –∫–æ–Ω—Å–æ–ª–∏.
          </p>
          <p>
            –í–∫–ª–∞–¥–∫–∞ <strong>üì¶ Storage</strong>. –ó–Ω–∞—á–µ–Ω–∏—è –º–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –ª–µ—Ç—É ‚Äî –ø—Ä–æ—Å—Ç–æ –∏–∑–º–µ–Ω–∏—Ç–µ —Ç–µ–∫—Å—Ç –∏ –Ω–∞–∂–º–∏—Ç–µ
            Enter –∏–ª–∏ –∫–ª–∏–∫–Ω–∏—Ç–µ –≤–Ω–µ –ø–æ–ª—è.
          </p>
        </section>

        <section>
          <h4>‚å®Ô∏è Terminal (CLI)</h4>
          <p>–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –≤–Ω—É—Ç—Ä–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –í–∫–ª–∞–¥–∫–∞ <strong>üíª Terminal</strong>.</p>
          <p>–ü—Ä–∏–º–µ—Ä—ã: <code>clear-cache</code>, <code>help</code>, <code>echo hello</code>.</p>
        </section>

        <section>
          <h4>üß≠ Navigation Trail</h4>
          <p>–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø—É—Ç–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º (—Ä–æ—É—Ç–∞–º).</p>
          <p>
            –í–∫–ª–∞–¥–∫–∞ <strong>üß≠ Navigation</strong> –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∏ –≤—Ä–µ–º–µ–Ω–µ–º –ø—Ä–µ–±—ã–≤–∞–Ω–∏—è –Ω–∞
            —Å—Ç—Ä–∞–Ω–∏—Ü–µ.
          </p>
        </section>

        <section class="help-sandbox-info">
          <h4>üèóÔ∏è –ì–¥–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å? (–ü–µ—Å–æ—á–Ω–∏—Ü–∞)</h4>
          <p>–°—Ç—Ä–∞–Ω–∏—Ü–∞ ¬´–ü–µ—Å–æ—á–Ω–∏—Ü—ã¬ª –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –±–æ–∫–æ–≤–æ–º –º–µ–Ω—é:</p>
          <p>–†–∞–∑–¥–µ–ª <strong>UI Demo</strong> ‚Üí <strong>Logger Console üõ†Ô∏è</strong></p>
          <p>
            –ü—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞:
            <a href="http://localhost:4200/ui-demo/logger-console" target="_blank"
              >http://localhost:4200/ui-demo/logger-console</a
            >
          </p>
        </section>
      </div>
    </div>
  </div>
  } @if (activeTab() === 'navigation') {
  <!-- Navigation Trail Component -->
  <div class="navigation-tab-content">
    <app-navigation-trail />
  </div>
  } @else if (activeTab() === 'storage') {
  <!-- Storage Editor Component -->
  <div class="storage-tab-content">
    <app-logger-storage-editor />
  </div>
  } @else if (activeTab() === 'terminal') {
  <!-- Terminal Component -->
  <div class="terminal-tab-content">
    <app-logger-terminal />
  </div>
  }
</div>
