<div class="simulator-tab-container">
  <!-- Header with Help Icons -->
  <div class="tab-section-header">
    <div class="header-main">
      <span nz-icon nzType="warning" nzTheme="twotone" [nzTwotoneColor]="'#faad14'"></span>
      <h2>–°–∏–º—É–ª—è—Ç–æ—Ä Auth & API</h2>
    </div>
    <div class="header-actions">
      <!-- Quick Help (?) -->
      <span
        nz-icon
        nzType="question-circle"
        nzTheme="outline"
        class="help-icon"
        nz-popover
        nzPopoverTitle="Simulator Quick Guide"
        [nzPopoverContent]="simHelpEn"
        nzPopoverPlacement="bottomRight"
      ></span>

      <!-- Detailed Info (!) -->
      <span
        nz-icon
        nzType="info-circle"
        nzTheme="twotone"
        class="help-icon info"
        nz-popover
        nzPopoverTitle="–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–∏–º—É–ª—è—Ç–æ—Ä–∞"
        [nzPopoverContent]="simHelpRu"
        nzPopoverPlacement="bottomRight"
      ></span>
    </div>
  </div>

  <!-- Help Templates -->
  <ng-template #simHelpEn>
    <div class="popover-help-content">
      <p>
        Use these tools to test how the application handles various <strong>edge cases</strong> and
        <strong>error states</strong>.
      </p>
      <ul>
        <li><strong>HTTP Errors:</strong> Verify Interceptor and UI notification logic.</li>
        <li><strong>Lifecycle:</strong> Test auto-refresh and session recovery.</li>
        <li><strong>Stress:</strong> Ensure queueing and stability under load.</li>
      </ul>
    </div>
  </ng-template>

  <ng-template #simHelpRu>
    <div class="popover-help-content russian">
      <p>
        <strong>–°–∏–º—É–ª—è—Ç–æ—Ä –æ—à–∏–±–æ–∫</strong> ‚Äî —ç—Ç–æ –ø–æ–ª–∏–≥–æ–Ω –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã—Ö
        —É—Å–ª–æ–≤–∏—è—Ö.
      </p>

      <div class="help-section">
        <span class="section-title">1. Simulate 401 (Unauthorized)</span>
        <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ <strong>Refresh Flow</strong>. –≠–º—É–ª–∏—Ä—É–µ—Ç –∏—Å—Ç–µ—á–µ–Ω–∏–µ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è —Ç–æ–∫–µ–Ω–∞.</p>
        <p class="outcome">
          <em>–†–µ–∑—É–ª—å—Ç–∞—Ç:</em> –ò–Ω—Ç–µ—Ä—Ü–µ–ø—Ç–æ—Ä –¥–æ–ª–∂–µ–Ω –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω –≤ —Ñ–æ–Ω–µ –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–ø—Ä–æ—Å. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –¥–æ–ª–∂–µ–Ω
          –∑–∞–º–µ—Ç–∏—Ç—å –æ—à–∏–±–∫–∏ –∏–ª–∏ –≤—ã–ª–µ—Ç–µ—Ç—å –∏–∑ —Å–∏—Å—Ç–µ–º—ã.
        </p>
      </div>

      <div class="help-section">
        <span class="section-title">2. Simulate 403 (Forbidden)</span>
        <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ <strong>–ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ (RBAC)</strong>. –ó–∞–ø—Ä–æ—Å –∫ —Ä–µ—Å—É—Ä—Å—É, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π —É –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤.</p>
        <p class="outcome">
          <em>–†–µ–∑—É–ª—å—Ç–∞—Ç:</em> –°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑–∞—Ç—å –æ—Ç–∫–∞–∑ –≤ –¥–æ—Å—Ç—É–ø–µ, –Ω–æ –ù–ï –¥–æ–ª–∂–Ω–∞ –ø—ã—Ç–∞—Ç—å—Å—è –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω –∏–ª–∏
          —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç—å –Ω–∞ –ª–æ–≥–∏–Ω.
        </p>
      </div>

      <div class="help-section">
        <span class="section-title">3. –°—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç (Concurrency)</span>
        <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ <strong>Refresh Lock</strong>. –°–∏–º—É–ª–∏—Ä—É–µ—Ç 10 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –ø—Ä–∏ "–ø—Ä–æ—Ç—É—Ö—à–µ–º" —Ç–æ–∫–µ–Ω–µ.</p>
        <p class="outcome">
          <em>–†–µ–∑—É–ª—å—Ç–∞—Ç:</em> –°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç—å <strong>—Ä–æ–≤–Ω–æ –æ–¥–∏–Ω</strong> –∑–∞–ø—Ä–æ—Å –Ω–∞ Refresh, –∑–∞–¥–µ—Ä–∂–∞–≤ –æ—Å—Ç–∞–ª—å–Ω—ã–µ
          –≤ –æ—á–µ—Ä–µ–¥–∏, –∞ –∑–∞—Ç–µ–º —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å –≤—Å–µ 10 –≤—ã–∑–æ–≤–æ–≤.
        </p>
      </div>

      <p class="warning-note">‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ: –ú–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏ —Å —Ç–æ–∫–µ–Ω–æ–º –≤ LS –º–æ–≥—É—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —Ä–∞–∑–ª–æ–≥–∏–Ω—É.</p>
    </div>
  </ng-template>

  <ng-template #tokenHelpContent>
    <div class="popover-help-content russian">
      <div class="help-section">
        <span class="section-title">üõ°Ô∏è –ó–∞—á–µ–º –Ω—É–∂–Ω—ã –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏?</span>
        <p>
          –≠—Ç–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –ø–æ–∑–≤–æ–ª—è—é—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –∏–º–∏—Ç–∏—Ä–æ–≤–∞—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–∏—Ç—É–∞—Ü–∏–∏ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞ (–∏—Å—Ç–µ—á–µ–Ω–∏–µ —Å—Ä–æ–∫–∞ –∏–ª–∏
          –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞), —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∞–∫—Ü–∏—é —Å–∏—Å—Ç–µ–º—ã –∑–∞—â–∏—Ç—ã.
        </p>
      </div>

      <div class="help-section">
        <span class="section-title">üöÄ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:</span>
        <div class="example-box">
          <strong>1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (Flow Test):</strong>
          <p>
            –ù–∞–∂–º–∏—Ç–µ <b>¬´–ü—Ä–æ—Ç—É—à–∏—Ç—å —Ç–æ–∫–µ–Ω¬ª</b> (—Å—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–∏—Ç—Å—è –Ω–∞ <i>Expired</i>), –∞ –∑–∞—Ç–µ–º –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –ª—é–±–æ–π –∑–∞–ø—Ä–æ—Å –≤
            –ü–µ—Å–æ—á–Ω–∏—Ü–µ. –ò–Ω—Ç–µ—Ä—Ü–µ–ø—Ç–æ—Ä —Å–∞–º –æ–±–Ω–æ–≤–∏—Ç —Ç–æ–∫–µ–Ω –∏ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç –≤–∞—à –∑–∞–ø—Ä–æ—Å.
          </p>
        </div>
        <div class="example-box">
          <strong>2. –¢–µ—Å—Ç –Ω–∞ —É—è–∑–≤–∏–º–æ—Å—Ç—å (Security Test):</strong>
          <p>
            –ù–∞–∂–º–∏—Ç–µ <b>¬´–ò—Å–ø–æ—Ä—Ç–∏—Ç—å —Ç–æ–∫–µ–Ω¬ª</b>. –í LocalStorage –∑–∞–ø–∏—à–µ—Ç—Å—è –Ω–µ–≤–∞–ª–∏–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞. –°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å —Å–±–æ–π
            –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å Logout –¥–ª—è –∑–∞—â–∏—Ç—ã –¥–∞–Ω–Ω—ã—Ö.
          </p>
        </div>
        <div class="example-box">
          <strong>3. –û—á–∏—Å—Ç–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:</strong>
          <p>
            –ù–∞–∂–º–∏—Ç–µ <b>¬´–°–±—Ä–æ—Å–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã¬ª</b>, —á—Ç–æ–±—ã —Å–∫—Ä—ã—Ç—å –±–∞–Ω–Ω–µ—Ä—ã —Å –æ—Ç—á–µ—Ç–∞–º–∏ –æ —Ç–µ—Å—Ç–∞—Ö –∏ –æ—á–∏—Å—Ç–∏—Ç—å –≤–∏–∑—É–∞–ª—å–Ω–æ–µ
            —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏–º—É–ª—è—Ç–æ—Ä–∞ –¥–ª—è –Ω–∞—á–∞–ª–∞ –Ω–æ–≤–æ–π —Å–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–æ–∫.
          </p>
        </div>
      </div>
    </div>
  </ng-template>

  <!-- Last Result Banner -->
  <nz-alert
    *ngIf="lastResult() as result"
    [nzType]="result.type || 'info'"
    [nzMessage]="msgTpl"
    [nzDescription]="descTpl"
    class="result-banner"
    nzShowIcon
    nzCloseable
    (nzOnClose)="clearResults()"
  >
    <ng-template #msgTpl>
      <div class="result-header">
        <span class="test-label">{{ result.message }}</span>
        <span class="status-badge" [class.success]="result.isSuccess" [class.error]="!result.isSuccess">
          {{ result.isSuccess ? '–¢–ï–°–¢ –£–°–ü–ï–®–ï–ù' : '–¢–ï–°–¢ –ù–ï –ü–†–û–®–ï–õ' }}
        </span>
      </div>
    </ng-template>

    <ng-template #descTpl>
      <div class="test-description" *ngIf="result.description">
        {{ result.description }}
      </div>

      <div class="result-status">
        <nz-tag [nzColor]="result.isSuccess ? 'success' : 'error'"> HTTP Status: {{ result.status }} </nz-tag>
      </div>

      <div class="result-verdict" *ngIf="result.verdict">
        <div class="verdict-title">–ü–û–î–†–û–ë–ù–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢:</div>
        <div class="verdict-text">{{ result.verdict }}</div>
      </div>
    </ng-template>
  </nz-alert>

  <div nz-row [nzGutter]="[20, 20]">
    <!-- 1. HTTP Error Triggers -->
    <div nz-col [nzXs]="24" [nzLg]="12">
      <nz-card nzTitle="–¢—Ä–∏–≥–≥–µ—Ä—ã HTTP –æ—à–∏–±–æ–∫">
        <p class="card-desc">–û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –∫–æ–¥—ã –æ—à–∏–±–æ–∫.</p>

        <div class="button-grid">
          <button nz-button nzDanger nzType="default" [nzLoading]="isLoading()" (click)="simulate401()">
            –°–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å <span class="line-small">401 (Auth)</span>
          </button>
          <button nz-button nzDanger nzType="default" [nzLoading]="isLoading()" (click)="simulate403()">
            –°–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å <span class="line-small">403 (Access)</span>
          </button>
          <button nz-button nzDanger nzType="default" [nzLoading]="isLoading()" (click)="simulate500()">
            –°–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å <span class="line-small">500 (Fail)</span>
          </button>
          <button nz-button nzType="default" [nzLoading]="isLoading()" (click)="simulateNetworkError()">
            –û—à–∏–±–∫–∞ —Å–µ—Ç–∏ <span class="line-small">(CORS/DNS)</span>
          </button>
        </div>
      </nz-card>
    </div>

    <!-- 2. Token Manipulation -->
    <div nz-col [nzXs]="24" [nzLg]="12">
      <nz-card [nzTitle]="tokenTitle" [nzExtra]="tokenHelp">
        <ng-template #tokenTitle>
          <span>–ú–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏ —Å —Ç–æ–∫–µ–Ω–∞–º–∏</span>
        </ng-template>
        <ng-template #tokenHelp>
          <span
            nz-icon
            nzType="question-circle"
            class="help-icon info"
            nz-popover
            [nzPopoverContent]="tokenHelpContent"
            nzPopoverPlacement="bottomRight"
            nzPopoverTitle="–ó–∞—á–µ–º –Ω—É–∂–Ω—ã –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏?"
          ></span>
        </ng-template>
        <p class="card-desc">–ò–∑–º–µ–Ω–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∞–∫—Ü–∏–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞.</p>

        <div class="button-grid">
          <button
            nz-button
            nzType="default"
            (click)="expireTokenNow()"
            nz-tooltip
            nzTooltipTitle="–û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≤ –ø–∞–º—è—Ç–∏"
          >
            "–ü—Ä–æ—Ç—É—à–∏—Ç—å" <span class="line-small">—Ç–æ–∫–µ–Ω</span>
          </button>
          <button
            nz-button
            nzType="default"
            (click)="corruptToken()"
            nz-tooltip
            nzTooltipTitle="–ó–∞–ø–∏—Å–∞—Ç—å –º—É—Å–æ—Ä –≤ LocalStorage"
          >
            –ò—Å–ø–æ—Ä—Ç–∏—Ç—å —Ç–æ–∫–µ–Ω <span class="line-small">(LocalStorage)</span>
          </button>
          <button nz-button nzType="default" (click)="clearResults()">
            –°–±—Ä–æ—Å–∏—Ç—å <span class="line-small">—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</span>
          </button>
        </div>

        <nz-divider nzText="–†–∏—Å–∫–æ–≤–∞–Ω–Ω–∞—è –∑–æ–Ω–∞"></nz-divider>
        <p class="small-text">–≠—Ç–∏ –¥–µ–π—Å—Ç–≤–∏—è –æ–±—Ö–æ–¥—è—Ç —Å–µ—Ä–≤–µ—Ä–Ω—É—é –ª–æ–≥–∏–∫—É –∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞.</p>
      </nz-card>
    </div>

    <!-- 3. Stress Testing -->
    <div nz-col [nzXs]="24">
      <nz-card nzTitle="–°—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ">
        <div class="stress-container">
          <div class="stress-info">
            <h3>–ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã–π —Ç–µ—Å—Ç (Concurrency)</h3>
            <p>
              –ó–∞–ø—É—Å–∫ 10 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ç–æ–∫–µ–Ω–∞.
            </p>
            <button
              nz-button
              nzType="primary"
              [nzLoading]="isLoading()"
              (click)="runConcurrencyTest()"
              class="stress-btn"
            >
              –ó–∞–ø—É—Å—Ç–∏—Ç—å 10 –∑–∞–ø—Ä–æ—Å–æ–≤
            </button>
          </div>

          <div class="stress-visual" *ngIf="concurrencyProgress() > 0">
            <span class="label">–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ:</span>
            <nz-progress
              [nzPercent]="concurrencyProgress()"
              [nzStatus]="'active'"
              [nzStrokeColor]="'#722ed1'"
            ></nz-progress>
          </div>
        </div>
      </nz-card>
    </div>
  </div>
</div>
