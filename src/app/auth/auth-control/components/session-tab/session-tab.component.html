<div class="session-tab-container">
  <div class="main-info">
    <!-- User Profile Card -->
    <nz-card [nzBordered]="false" class="profile-card">
      <nz-card-meta
        [nzTitle]="titleTemplate"
        [nzDescription]="descriptionTemplate"
        [nzAvatar]="avatarTemplate"
      ></nz-card-meta>

      <ng-template #avatarTemplate>
        <nz-avatar [nzSize]="64" [nzSrc]="currentUser()?.avatar" [nzIcon]="'user'" style="background-color: #1890ff">
        </nz-avatar>
      </ng-template>

      <ng-template #titleTemplate>
        <div class="card-header">
          <h3>{{ currentUser()?.fullName || 'Гость' }}</h3>
          <nz-tag [nzColor]="isAuthenticated() ? 'success' : 'default'">
            {{ isAuthenticated() ? 'Авторизован' : 'Гость' }}
          </nz-tag>
        </div>
      </ng-template>

      <ng-template #descriptionTemplate>
        <div class="user-details">
          <p class="email">
            <span nz-icon nzType="mail"></span>
            {{ currentUser()?.email || 'No email' }}
          </p>

          <!-- Authentication Provider -->
          <p class="auth-provider" *ngIf="currentUser()">
            <span nz-icon nzType="login"></span>
            <span *ngIf="!currentUser()?.isExternalAccount" class="provider-badge email-provider">
              <span nz-icon nzType="mail"></span>
              Email/Password
            </span>
            <span
              *ngIf="currentUser()?.isExternalAccount && currentUser()?.externalProvider === 'Google'"
              class="provider-badge google-provider"
            >
              <span nz-icon nzType="google"></span>
              Google
            </span>
            <span
              *ngIf="currentUser()?.isExternalAccount && currentUser()?.externalProvider === 'Facebook'"
              class="provider-badge facebook-provider"
            >
              <span nz-icon nzType="facebook" nzTheme="fill"></span>
              Facebook
            </span>
          </p>

          <div class="roles-list">
            <nz-tag *ngFor="let role of userRoles()" [nzColor]="'blue'">
              {{ role }}
            </nz-tag>
          </div>
        </div>
      </ng-template>

      <div class="card-actions">
        <button nz-button nzType="primary" (click)="refreshSession()">
          <span nz-icon nzType="sync"></span> Обновить данные
        </button>
        <button nz-button nzDanger (click)="logout()"><span nz-icon nzType="logout"></span> Выйти из системы</button>
      </div>
    </nz-card>

    <!-- Session Stats -->
    <div class="stats-grid">
      <nz-card>
        <nz-statistic
          [nzValue]="(currentUser()?.lastLogin | date : 'shortTime') || '-'"
          [nzTitle]="'Время входа'"
          [nzPrefix]="prefixLogin"
        >
        </nz-statistic>
        <ng-template #prefixLogin><span nz-icon nzType="login"></span></ng-template>
      </nz-card>

      <nz-card>
        <nz-statistic [nzValue]="'2ч 15м'" [nzTitle]="'Длительность'" [nzPrefix]="prefixClock"> </nz-statistic>
        <ng-template #prefixClock><span nz-icon nzType="clock-circle"></span></ng-template>
      </nz-card>
    </div>
  </div>

  <!-- Timeline Side -->
  <div class="timeline-section">
    <nz-card [nzTitle]="'События сессии'" [nzBordered]="false" class="timeline-card">
      <nz-list [nzDataSource]="sessionEvents()" [nzRenderItem]="item" [nzItemLayout]="'horizontal'">
        <ng-template #item let-item>
          <nz-list-item>
            <nz-list-item-meta [nzTitle]="item.type | titlecase" [nzDescription]="item.message">
              <nz-list-item-meta-avatar>
                <div class="event-icon" [class]="item.status">
                  <span nz-icon [nzType]="item.status === 'success' ? 'check-circle' : 'info-circle'"></span>
                </div>
              </nz-list-item-meta-avatar>
            </nz-list-item-meta>
            <div>{{ item.timestamp | date : 'HH:mm:ss' }}</div>
          </nz-list-item>
        </ng-template>
      </nz-list>
    </nz-card>
  </div>
</div>
