<div class="playground-container" [@fadeIn]>
  <!-- Help & Info -->
  <div class="playground-header">
    <div class="info-badges">
      <nz-tag [nzColor]="'purple'"> <span nz-icon nzType="api"></span> –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å API </nz-tag>

      <!-- Russian Help -->
      <nz-tag
        [nzColor]="'geekblue'"
        nz-popover
        [nzPopoverContent]="helpRuTemplate"
        nzPopoverTitle="–°–ø—Ä–∞–≤–∫–∞ –ø–æ –ü–µ—Å–æ—á–Ω–∏—Ü–µ"
      >
        <span nz-icon nzType="question-circle"></span> –ü–æ–º–æ—â—å
      </nz-tag>
      <ng-template #helpRuTemplate>
        <div class="help-content-popover ru">
          <p>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.</p>

          <div class="help-section">
            <span class="section-title">üõ°Ô∏è –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏:</span>
            <ul>
              <li>
                <strong>HttpOnly Cookies:</strong> –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∞—é—Ç –≤–∞—à–∏ —Ç–µ–∫—É—â–∏–µ Cookies. –§—Ä–æ–Ω—Ç–µ–Ω–¥ –Ω–µ
                –∏–º–µ–µ—Ç –∫ –Ω–∏–º –¥–æ—Å—Ç—É–ø–∞, –∏—Ö –ø—Ä–∏–∫—Ä–µ–ø–ª—è–µ—Ç —Å–∞–º –±—Ä–∞—É–∑–µ—Ä –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.
              </li>
              <li>
                <strong>X-Simulator-Request:</strong> –ú—ã –¥–æ–±–∞–≤–ª—è–µ–º —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫, —á—Ç–æ–±—ã —Å–µ—Ä–≤–µ—Ä –ø–æ–Ω–∏–º–∞–ª: –∑–∞–ø—Ä–æ—Å –ø—Ä–∏—à–µ–ª
                –∏–∑ –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–µ—Ä–≤–µ—Ä—É –≤–µ—Å—Ç–∏ –æ—Ç–¥–µ–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–ª–∏ –æ—Å–æ–±—ã–º –æ–±—Ä–∞–∑–æ–º –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å
                –æ—Ç–ª–∞–¥–∫—É.
              </li>
              <li>
                <strong>–ê–≤—Ç–æ-–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:</strong> –ï—Å–ª–∏ –≤–æ –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ –≤–∞—à–∞ —Å–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞, —Å–∏—Å—Ç–µ–º–∞
                —Å–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç Refresh-–ø–æ—Ç–æ–∫, –∞ –∑–∞—Ç–µ–º ¬´–ø—Ä–æ–∑—Ä–∞—á–Ω–æ¬ª –æ—Ç–ø—Ä–∞–≤–∏—Ç –≤–∞—à –æ—Ç–ª–∞–¥–æ—á–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å –Ω–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.
              </li>
            </ul>
          </div>

          <div class="help-section">
            <span class="section-title">‚öôÔ∏è –ü–æ—Ä—è–¥–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π:</span>
            <p>1. –í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–π URL (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ–≤–µ—Ä–∫—É –ü—Ä–æ—Ñ–∏–ª—è –∏–ª–∏ –ê–¥–º–∏–Ω-—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É).</p>
            <p>
              2. –ù–∞–∂–º–∏—Ç–µ ¬´–í—ã–ø–æ–ª–Ω–∏—Ç—å¬ª. –í –±–ª–æ–∫–µ –æ—Ç–≤–µ—Ç–∞ –≤—ã —É–≤–∏–¥–∏—Ç–µ <i>—á–µ—Å—Ç–Ω—ã–π</i> —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞: –æ—Ç JSON-–¥–∞–Ω–Ω—ã—Ö –¥–æ
              —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± –æ—Ç–∫–∞–∑–µ –≤ –¥–æ—Å—Ç—É–ø–µ (403).
            </p>
          </div>

          <div class="help-section">
            <span class="section-title">üåü –†–µ–∞–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π (–ü—Ä–∏–º–µ—Ä):</span>
            <div
              class="example-box"
              style="
                background: rgba(24, 144, 255, 0.05);
                border-left: 4px solid #1890ff;
                padding: 10px;
                border-radius: 4px;
              "
            >
              <strong>–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:</strong>
              <p>
                –í—ã —Å—á–∏—Ç–∞–µ—Ç–µ, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∞, –Ω–æ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –∫–Ω–æ–ø–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞. –í –ü–µ—Å–æ—á–Ω–∏—Ü–µ –≤—ã–±–µ—Ä–∏—Ç–µ
                —ç–Ω–¥–ø–æ–∏–Ω—Ç <code>/api/Admin/statistics</code> –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–í—ã–ø–æ–ª–Ω–∏—Ç—å¬ª.
              </p>
              <p style="margin-top: 5px; font-size: 11px">
                <i>–ö—Å—Ç–∞—Ç–∏:</i> –ï—Å–ª–∏ –≤ —Å–ø–∏—Å–∫–µ –Ω–µ—Ç –Ω—É–∂–Ω–æ–≥–æ –∞–¥—Ä–µ—Å–∞, –≤—ã–±–µ—Ä–∏—Ç–µ <b>¬´–°–≤–æ–π –∑–∞–ø—Ä–æ—Å...¬ª</b> –∏ –≤–≤–µ–¥–∏—Ç–µ –ª—é–±–æ–π URL
                –≤—Ä—É—á–Ω—É—é.
              </p>
            </div>
          </div>
        </div>
      </ng-template>
    </div>
  </div>

  <div nz-row [nzGutter]="24">
    <!-- Configuration Column -->
    <div nz-col [nzSpan]="10">
      <nz-card nzTitle="–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–ø—Ä–æ—Å–∞" [nzBordered]="false" class="glass-card">
        <div class="request-form">
          <div class="form-item">
            <label>–í—ã–±–µ—Ä–∏—Ç–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç:</label>
            <nz-select [ngModel]="selectedIndex()" (ngModelChange)="onEndpointChange($event)" nzSize="large" nzBlock>
              <nz-option *ngFor="let ep of endpoints; let i = index" [nzLabel]="ep.label" [nzValue]="i"></nz-option>
            </nz-select>
          </div>

          <!-- URL Input for Predefined or Custom -->
          <div class="form-item" *ngIf="selectedIndex() === endpoints.length - 1; else predefinedDetails">
            <label>–ú–µ—Ç–æ–¥ –∏ URL:</label>
            <nz-input-group [nzAddOnBefore]="methodSelect">
              <input
                type="text"
                nz-input
                [(ngModel)]="customUrl"
                placeholder="/api/MyController/action"
                nzSize="large"
              />
            </nz-input-group>
            <ng-template #methodSelect>
              <nz-select [(ngModel)]="selectedMethod" style="width: 100px">
                <nz-option nzLabel="GET" nzValue="GET"></nz-option>
                <nz-option nzLabel="POST" nzValue="POST"></nz-option>
                <nz-option nzLabel="PUT" nzValue="PUT"></nz-option>
                <nz-option nzLabel="DELETE" nzValue="DELETE"></nz-option>
              </nz-select>
            </ng-template>
            <p class="helper-text">–í—ã –º–æ–∂–µ—Ç–µ –≤–≤–æ–¥–∏—Ç—å –∫–∞–∫ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ (/api/..), —Ç–∞–∫ –∏ –ø–æ–ª–Ω—ã–µ (https://..) –ø—É—Ç–∏.</p>
          </div>

          <ng-template #predefinedDetails>
            <div class="endpoint-details" *ngIf="endpoints[selectedIndex()] as ep">
              <div class="method-url">
                <span class="method-badge" [class]="ep.method.toLowerCase()">{{ ep.method }}</span>
                <code class="url-text">{{ ep.url }}</code>
              </div>
              <p class="description-text">{{ ep.description }}</p>
            </div>
          </ng-template>

          <nz-divider></nz-divider>

          <div class="actions">
            <button nz-button nzType="primary" nzSize="large" [nzLoading]="isLoading()" (click)="sendRequest()" nzBlock>
              <span nz-icon nzType="send"></span> –í—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å
            </button>
          </div>
        </div>
      </nz-card>

      <nz-alert
        nzType="info"
        nzMessage="–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∏–Ω—Ç–µ—Ä—Ü–µ–ø—Ç–æ—Ä–∞ –∞–∫—Ç–∏–≤–Ω–∞"
        nzDescription="–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –±—É–¥—É—Ç –ø–æ—Å—Ç–∞–≤–ª–µ–Ω—ã –≤ –æ—á–µ—Ä–µ–¥—å, –µ—Å–ª–∏ –∏–¥–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞."
        nzShowIcon
        style="margin-top: 16px"
      ></nz-alert>
    </div>

    <!-- Response Column -->
    <div nz-col [nzSpan]="14">
      <nz-card
        nzTitle="–ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç–≤–µ—Ç–∞"
        [nzBordered]="false"
        class="glass-card response-card"
        [nzExtra]="responseExtra"
      >
        <ng-template #responseExtra>
          <button nz-button nzType="text" (click)="lastResponse.set(null)" [disabled]="!lastResponse()">
            –û—á–∏—Å—Ç–∏—Ç—å
          </button>
        </ng-template>

        <div class="response-placeholder" *ngIf="!lastResponse() && !isLoading()">
          <span nz-icon nzType="code-sandbox" class="p-icon"></span>
          <p>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞.</p>
        </div>

        <div class="response-spinner" *ngIf="isLoading()">
          <nz-spin nzSimple nzTip="–ó–∞–≥—Ä—É–∑–∫–∞..."></nz-spin>
        </div>

        <div class="response-content" *ngIf="lastResponse() as res">
          <div class="response-header-meta">
            <nz-tag [nzColor]="res.ok ? 'success' : 'error'" class="status-tag">
              –°—Ç–∞—Ç—É—Å: {{ res.status }} {{ res.statusText }}
            </nz-tag>
            <span class="timestamp">{{ res.timestamp | date : 'HH:mm:ss.SSS' }}</span>
          </div>

          <nz-tabset nzSize="small" [nzAnimated]="false">
            <nz-tab nzTitle="–¢–µ–ª–æ –æ—Ç–≤–µ—Ç–∞ (JSON)">
              <div class="code-block">
                <pre><code>{{ getJsonString(res.body) }}</code></pre>
              </div>
            </nz-tab>
            <nz-tab nzTitle="–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ">
              <nz-descriptions [nzColumn]="1" nzBordered nzSize="small">
                <nz-descriptions-item nzTitle="–£—Å–ø–µ—à–Ω–æ">{{ res.ok ? '–î–∞' : '–ù–µ—Ç' }}</nz-descriptions-item>
                <nz-descriptions-item nzTitle="–ö–æ–¥ —Å—Ç–∞—Ç—É—Å–∞">{{ res.status }}</nz-descriptions-item>
                <nz-descriptions-item nzTitle="–°–æ–æ–±—â–µ–Ω–∏–µ">{{ res.statusText }}</nz-descriptions-item>
                <nz-descriptions-item nzTitle="–í—Ä–µ–º—è">{{ res.timestamp | date : 'medium' }}</nz-descriptions-item>
              </nz-descriptions>
            </nz-tab>
          </nz-tabset>
        </div>
      </nz-card>
    </div>
  </div>
</div>
